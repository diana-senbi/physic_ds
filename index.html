<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhysicsMind ‚Äî –≠–ª–µ–∫—Ç—Ä –∂”ô–Ω–µ –ú–∞–≥–Ω–µ—Ç–∏–∑–º (9 —Å—ã–Ω—ã–ø)</title>
  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <style>
    :root{
      --bg:#F3F7FF;
      --card:#FFFFFF;
      --text:#0B1220;
      --muted:#5B6B84;
      --blue:#2563EB;
      --blue2:#3B82F6;
      --line:rgba(37,99,235,.16);
      --shadow:0 14px 40px rgba(2, 8, 23, .08);
      --r:18px;
      --ok:#16A34A;
      --bad:#EF4444;
      --softBlue:#EFF6FF;
      --softOk:#ECFDF5;
      --softBad:#FFF1F2;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:radial-gradient(1200px 600px at 20% 0%, #EAF2FF 0%, var(--bg) 60%) fixed;
      color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    header{
      position:sticky;top:0;z-index:10;
      background:rgba(243,247,255,.86);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1050px;margin:0 auto;padding:14px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{
      display:flex;align-items:center;gap:10px;
      padding:8px 12px;border-radius:999px;
      background:var(--card);box-shadow:var(--shadow);
      border:1px solid rgba(15,23,42,.06);
    }
    .brand img{
      width:34px;height:34px;border-radius:12px;object-fit:cover;
      border:1px solid rgba(37,99,235,.25);
      background:#fff;
    }
    .brand b{font-size:14px}
    .brand span{display:block;font-size:12px;color:var(--muted);margin-top:2px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      background:var(--softBlue);
      border:1px solid rgba(37,99,235,.18);
      color:#1D2A44;font-size:12px;
    }
    main{padding:16px}
    .card{
      background:var(--card);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      border:1px solid rgba(15,23,42,.06);
      padding:16px;margin:14px 0;
    }
    .grid{display:grid;gap:12px}
    @media(min-width:820px){.grid.two{grid-template-columns:1fr 1fr}}
    h2,h3{margin:0}
    .title{font-size:18px}
    .muted{color:var(--muted);font-size:12px;line-height:1.4}
    .small{font-size:12px;color:var(--muted)}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input{
      width:100%;padding:12px 12px;border-radius:14px;
      border:1px solid rgba(37,99,235,.22);
      outline:none;background:#fff;font-size:14px;
    }
    input:focus{
      border-color:rgba(37,99,235,.55);
      box-shadow:0 0 0 4px rgba(37,99,235,.12);
    }
    .btnrow{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:none;border-radius:14px;padding:12px 14px;cursor:pointer;
      font-weight:800;letter-spacing:.2px;
    }
    .btn{
      background:linear-gradient(135deg,var(--blue),var(--blue2));
      color:#fff;
    }
    .btn.ghost{
      background:transparent;
      border:1px solid rgba(37,99,235,.25);
      color:#0B1220;
    }
    .btn.gray{
      background:#0F172A;color:#fff;
    }
    .btn.green{
      background:linear-gradient(135deg,#16A34A,#22C55E);color:#fff;
    }
    .rolebtn{
      width:100%;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px;border-radius:16px;
      border:1px solid rgba(37,99,235,.18);
      background:#fff;
    }
    .rolebtn:hover{box-shadow:0 10px 28px rgba(2,8,23,.08)}
    .roleleft{display:flex;align-items:center;gap:10px}
    .icon{
      width:38px;height:38px;border-radius:14px;display:grid;place-items:center;
      background:var(--softBlue);
      border:1px solid rgba(37,99,235,.18);
      font-weight:900;color:#1E3A8A;
    }
    .hide{display:none}
    .note{
      padding:12px;border-radius:14px;background:#fff;
      border:1px dashed rgba(37,99,235,.25);
    }
    .q{
      padding:12px;border-radius:16px;
      border:1px solid rgba(37,99,235,.16);
      background:#fff;margin-top:10px;
    }
    .qhead{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap}
    .badge{
      font-size:11px;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(37,99,235,.18);
      background:#F8FBFF;color:#1D2A44
    }
    .ok{background:var(--softOk);border-color:rgba(34,197,94,.25)}
    .bad{background:var(--softBad);border-color:rgba(239,68,68,.25)}
    .ans{display:grid;gap:8px;margin-top:10px}
    .opt{
      display:flex;gap:10px;align-items:flex-start;
      padding:10px;border-radius:14px;
      border:1px solid rgba(37,99,235,.14);
      cursor:pointer;
      background:#fff;
    }
    .opt input{width:auto;margin-top:2px}
    .opt:hover{background:#F8FBFF}
    .bar{height:10px;background:#E6EEFF;border-radius:999px;overflow:hidden}
    .bar > div{
      height:100%;
      background:linear-gradient(135deg,var(--blue),var(--blue2));
      width:0%;
    }
    .list{padding-left:16px;margin:8px 0}
    .locked{opacity:.55;pointer-events:none;filter:grayscale(.2)}
    .chiprow{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{
      font-size:12px;padding:8px 10px;border-radius:999px;
      background:var(--softBlue);
      border:1px solid rgba(37,99,235,.18);
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      background:linear-gradient(135deg,var(--blue),var(--blue2));
      color:#fff;border-color:transparent;
    }
    .cards{
      display:grid;gap:12px;
    }
    @media(min-width:820px){.cards{grid-template-columns:1fr 1fr}}
    .kcard{
      border-radius:16px;
      border:1px solid rgba(37,99,235,.16);
      background:#fff;
      padding:14px;
      box-shadow:0 10px 26px rgba(2,8,23,.06);
    }
    .khead{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .kname{font-weight:900}
    .kmeta{font-size:12px;color:var(--muted);margin-top:4px}
    .kline{height:1px;background:rgba(37,99,235,.12);margin:10px 0}
    .krow{display:flex;gap:10px;flex-wrap:wrap}
    .tag{
      font-size:12px;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(37,99,235,.18);
      background:#F8FBFF;
      color:#1D2A44;
    }
    .tag.ok{background:var(--softOk);border-color:rgba(34,197,94,.25)}
    .tag.bad{background:var(--softBad);border-color:rgba(239,68,68,.25)}
    .danger{color:var(--bad);font-weight:900}
    .success{color:var(--ok);font-weight:900}
  </style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo" />
      <div>
        <b>PhysicsMind</b>
        <span>–≠–ª–µ–∫—Ç—Ä & –ú–∞–≥–Ω–µ—Ç–∏–∑–º ‚Ä¢ 9 —Å—ã–Ω—ã–ø ‚Ä¢ Minimal Blue</span>
      </div>
    </div>
    <span class="pill">üß† –®–µ–∫—Ç–µ—É–ª—ñ –∂–∞–¥ ‚Ä¢ “ö–∞—Ç–µ —Ç–∞–ª–¥–∞—É ‚Ä¢ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å ‚Ä¢ –†–µ—Ñ–ª–µ–∫—Å–∏—è</span>
  </div>
</header>

<main class="wrap">

  <!-- ROLE -->
  <div class="card" id="roleCard">
    <h2 class="title">–ö—ñ—Ä—É —Ä–µ–∂–∏–º—ñ–Ω —Ç–∞“£–¥–∞</h2>
    <p class="muted">–û“õ—É—à—ã —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä–∞–¥—ã. –ú“±“ì–∞–ª—ñ–º –±–∞—Ä–ª—ã“õ –æ“õ—É—à—ã–Ω—ã“£ –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω –∂”ô–Ω–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏—è—Å—ã–Ω –∂–µ–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–µ–Ω –∫”©—Ä–µ–¥—ñ.</p>

    <div class="grid two" style="margin-top:12px;">
      <button class="rolebtn" onclick="setRole('student')">
        <div class="roleleft">
          <div class="icon">–û</div>
          <div style="text-align:left">
            <b>–û“õ—É—à—ã</b>
            <div class="muted">–¢–µ—Å—Ç ‚Ä¢ “ö–∞—Ç–µ —Ç—ñ–∑—ñ–º—ñ ‚Ä¢ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å ‚Ä¢ –†–µ—Ñ–ª–µ–∫—Å–∏—è</div>
          </div>
        </div>
        <span class="muted">‚Üí</span>
      </button>

      <button class="rolebtn" onclick="setRole('teacher')">
        <div class="roleleft">
          <div class="icon">–ú</div>
          <div style="text-align:left">
            <b>–ú“±“ì–∞–ª—ñ–º</b>
            <div class="muted">–ù”ô—Ç–∏–∂–µ ‚Ä¢ –ö–∞—Ä—Ç–æ—á–∫–∞–ª–∞—Ä ‚Ä¢ –¢–û–ü “õ–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä</div>
          </div>
        </div>
        <span class="muted">‚Üí</span>
      </button>
    </div>

    <div class="note muted" style="margin-top:12px;">
      –ï—Å–∫–µ—Ä—Ç—É: –±“±–ª –Ω“±—Å“õ–∞–¥–∞ ‚Äú–∂—ñ–±–µ—Ä—É‚Äù DEMO —Ä–µ—Ç—ñ–Ω–¥–µ –±—Ä–∞—É–∑–µ—Ä–¥–µ —Å–∞“õ—Ç–∞–ª–∞–¥—ã (localStorage). –ö–µ–π—ñ–Ω Google Sheets/Firebase “õ–æ—Å—É“ì–∞ –±–æ–ª–∞–¥—ã.
    </div>
  </div>

  <!-- LOGIN -->
  <div class="card hide" id="loginCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title" id="loginTitle">–ö—ñ—Ä—É</h2>
        <p class="muted" id="loginHint">–õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä.</p>
      </div>
      <button class="btn ghost" onclick="backToRole()">‚Üê –ê—Ä—Ç“õ–∞</button>
    </div>

    <div class="grid two" style="margin-top:10px;">
      <div>
        <label>–õ–æ–≥–∏–Ω</label>
        <input id="login" placeholder="–º—ã—Å: 9a01 –Ω–µ–º–µ—Å–µ teacher" />
      </div>
      <div>
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input id="pass" type="password" placeholder="–º—ã—Å: A1b2C3" />
      </div>
    </div>

    <div class="btnrow" style="margin-top:12px;">
      <button class="btn" onclick="doLogin()">–ö—ñ—Ä—É</button>
      <button class="btn gray" onclick="fillDemo()">Demo —Ç–æ–ª—Ç—ã—Ä—É</button>
    </div>

    <div class="note small" style="margin-top:12px;">
      –ú“±“ì–∞–ª—ñ–º –ª–æ–≥–∏–Ω—ñ: <b>teacher</b> ‚Ä¢ –ø–∞—Ä–æ–ª—å: <b>0000</b><br/>
      –û“õ—É—à—ã–ª–∞—Ä –ª–æ–≥–∏–Ω—ñ/–ø–∞—Ä–æ–ª—ñ —Ç—ñ–∑—ñ–º–º–µ–Ω –±–µ—Ä—ñ–ª–µ–¥—ñ (–∫–æ–¥—Ç–∞“ì—ã <code>STUDENTS</code> –º–∞—Å—Å–∏–≤—ñ).
    </div>

    <div class="note small" style="margin-top:12px;">
      –ï–≥–µ—Ä —Ç—ñ–∑—ñ–º–¥—ñ ”©–∑–≥–µ—Ä—Ç—É –∫–µ—Ä–µ–∫ –±–æ–ª—Å–∞: <b>STUDENTS</b> –±”©–ª—ñ–º—ñ–Ω–µ ”©–∑ —Å—ã–Ω—ã–±—ã“£–Ω—ã“£ –æ“õ—É—à—ã–ª–∞—Ä—ã–Ω –µ–Ω–≥—ñ–∑—ñ–ø “õ–æ—è—Å—ã“£.
    </div>
  </div>

  <!-- STUDENT -->
  <div class="card hide" id="studentCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title">–û“õ—É—à—ã –ø–∞–Ω–µ–ª—ñ</h2>
        <p class="muted" id="studentMeta"></p>
      </div>
      <div class="btnrow">
        <button class="btn ghost" onclick="logout()">–®—ã“ì—É</button>
      </div>
    </div>

    <div class="note" id="stateNote" style="margin-top:12px;"></div>

    <div id="testArea" style="margin-top:12px;"></div>

    <div class="card" style="margin-top:12px;background:#fff;border:1px solid rgba(37,99,235,.14)">
      <h3 class="title">–ù”ô—Ç–∏–∂–µ</h3>
      <div style="margin-top:10px;">
        <div class="bar"><div id="barFill"></div></div>
        <div class="muted" id="scoreLine" style="margin-top:8px;">”ò–ª—ñ —Ç–∞–ø—Å—ã—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.</div>
      </div>

      <div class="grid two" style="margin-top:12px;">
        <div class="note">
          <b>“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ</b>
          <ul class="list" id="wrongList"><li class="muted">”ò–∑—ñ—Ä–≥–µ –∂–æ“õ.</li></ul>
        </div>
        <div class="note">
          <b>–®–µ–∫—Ç–µ—É–ª—ñ –∂–∞–¥ –ª–æ–≥–∏–∫–∞—Å—ã</b>
          <div class="small" id="ruleText"></div>
        </div>
      </div>

      <!-- Reflection (cards style) -->
      <div class="note" style="margin-top:12px;">
        <b>–†–µ—Ñ–ª–µ–∫—Å–∏—è (–µ—Ä–µ–∫—à–µ —Ñ–æ—Ä–º–∞—Ç)</b>
        <div class="small">–°–æ“£—ã–Ω–¥–∞ –º“±“ì–∞–ª—ñ–º–≥–µ ‚Äú–∂–µ–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–µ–Ω‚Äù –∫”©—Ä—ñ–Ω–µ–¥—ñ.</div>

        <div style="margin-top:12px;">
          <div class="small"><b>1) ”®–∑ —Å–µ–∑—ñ–º—ñ“£:</b></div>
          <div class="chiprow" id="moodChips">
            <div class="chip" onclick="pickMood('üòå –ñ–µ“£—ñ–ª')">üòå –ñ–µ“£—ñ–ª</div>
            <div class="chip" onclick="pickMood('üôÇ –ù–æ—Ä–º')">üôÇ –ù–æ—Ä–º</div>
            <div class="chip" onclick="pickMood('üòµ “ö–∏—ã–Ω')">üòµ “ö–∏—ã–Ω</div>
            <div class="chip" onclick="pickMood('üò§ –¢“Ø—Å—ñ–Ω–±–µ–¥—ñ–º')">üò§ –¢“Ø—Å—ñ–Ω–±–µ–¥—ñ–º</div>
          </div>
          <div class="small" id="moodView" style="margin-top:6px;">–¢–∞“£–¥–∞–ª–º–∞–¥—ã</div>
        </div>

        <div style="margin-top:12px;">
          <div class="small"><b>2) “ö–∞–π –∂–µ—Ä–¥–µ “õ–∏–Ω–∞–ª–¥—ã“£?</b> (–±—ñ—Ä–Ω–µ—à–µ—É—ñ–Ω —Ç–∞“£–¥–∞)</div>
          <div style="margin-top:8px;display:grid;gap:8px;">
            <label class="opt"><input type="checkbox" id="d_formula"> –§–æ—Ä–º—É–ª–∞</label>
            <label class="opt"><input type="checkbox" id="d_units"> ”®–ª—à–µ–º –±—ñ—Ä–ª—ñ–∫</label>
            <label class="opt"><input type="checkbox" id="d_circuit"> –°—Ö–µ–º–∞/—Ç—ñ–∑–±–µ–∫</label>
            <label class="opt"><input type="checkbox" id="d_concept"> “∞“ì—ã–º/—Ç–µ–æ—Ä–∏—è</label>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div class="small"><b>3) 1 “õ–∞–¥–∞–º (–∫–µ–ª–µ—Å—ñ–¥–µ):</b></div>
          <input id="nextStep" placeholder="–º—ã—Å: –±—ñ—Ä–ª—ñ–∫—Ç—ñ —Ç–µ–∫—Å–µ—Ä–µ–º, —Ñ–æ—Ä–º—É–ª–∞–Ω—ã –∂–∞–∑—ã–ø —à—ã“ì–∞–º..." />
        </div>
      </div>

      <div class="btnrow" style="margin-top:12px;">
        <button class="btn green locked" id="btnRemed" onclick="openRemediation()">‚úÖ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</button>
        <button class="btn locked" id="btnSend" onclick="sendToTeacher()">üì© –ú“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä—É</button>
        <button class="btn ghost locked" id="btnRetry" onclick="resetAttempt()">“ö–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—É</button>
      </div>
      <div class="small" id="sendStatus" style="margin-top:8px;"></div>
    </div>
  </div>

  <!-- REMEDIATION -->
  <div class="card hide" id="remedCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</h2>
        <p class="muted">
          –ï—Ä–µ–∂–µ: –º“±–Ω–¥–∞ <b>–¥“±—Ä—ã—Å –∂–∞—É–∞–ø —Ç–∞, —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –¥–µ –∫”©—Ä—Å–µ—Ç—ñ–ª–º–µ–π–¥—ñ</b>.
          –ê–ª–¥—ã–º–µ–Ω ”©–∑—ñ“£ —Ç“Ø–∑–µ—Ç—ñ–ø –∂–∞—É–∞–ø –±–µ—Ä–µ—Å—ñ“£. <b>–°–æ“£—ã–Ω–¥–∞ “ì–∞–Ω–∞</b> –¥“±—Ä—ã—Å –∂–∞—É–∞–ø –ø–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∞—à—ã–ª–∞–¥—ã.
        </p>
      </div>
      <button class="btn ghost" onclick="closeRemediation()">‚Üê –ê—Ä—Ç“õ–∞</button>
    </div>

    <div id="remedArea" style="margin-top:12px;"></div>

    <div class="btnrow" style="margin-top:12px;">
      <button class="btn green" onclick="finishRemediation()">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å—Ç—ã –∞—è“õ—Ç–∞—É</button>
    </div>
    <div class="small" id="remedStatus" style="margin-top:8px;"></div>

    <div class="card hide" id="remedRevealCard" style="margin-top:12px;">
      <h3 class="title">–°–æ“£“ì—ã “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã (–¥“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç–∞—Ä –∞—à—ã–ª–¥—ã)</h3>
      <div class="small">–ë“±–ª –±”©–ª—ñ–º —Ç–µ–∫ “õ–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å —Ç–æ–ª—ã“õ ”©—Ç–∫–µ–Ω —Å–æ“£ —à—ã“ì–∞–¥—ã.</div>
      <div id="remedReveal" style="margin-top:12px;"></div>
    </div>
  </div>

  <!-- TEACHER -->
  <div class="card hide" id="teacherCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title">–ú“±“ì–∞–ª—ñ–º –ø–∞–Ω–µ–ª—ñ (–∫–∞—Ä—Ç–æ—á–∫–∞)</h2>
        <p class="muted">”ò—Ä –æ“õ—É—à—ã–Ω—ã“£ –Ω”ô—Ç–∏–∂–µ—Å—ñ + —Ä–µ—Ñ–ª–µ–∫—Å–∏—è—Å—ã –∂–µ–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–µ–Ω –∫”©—Ä—ñ–Ω–µ–¥—ñ.</p>
      </div>
      <div class="btnrow">
        <button class="btn ghost" onclick="logout()">–®—ã“ì—É</button>
        <button class="btn" onclick="refreshTeacher()">–ñ–∞“£–∞—Ä—Ç—É</button>
        <button class="btn gray" onclick="clearTeacherData()">–¢–∞–∑–∞–ª–∞—É (DEMO)</button>
      </div>
    </div>

    <div class="grid two" style="margin-top:12px;">
      <div class="note">
        <b>–û“õ—É—à—ã–ª–∞—Ä –∫–∞—Ä—Ç–æ—á–∫–∞–ª–∞—Ä—ã</b>
        <div class="small">–¢–µ–∫ ‚Äú–ñ—ñ–±–µ—Ä—É‚Äù –±–∞—Å—ã–ª“ì–∞–Ω –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä.</div>
      </div>
      <div class="note">
        <b>–¢–û–ü “õ–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä</b>
        <div class="small">–ù–∞“õ—Ç—ã –µ—Å–µ–ø—Ç–µ–ª–µ–¥—ñ (“õ–∞–π —Å“±—Ä–∞“õ—Ç–∞–Ω –∫”©–ø “õ–∞—Ç–µ –∫–µ—Ç–∫–µ–Ω—ñ).</div>
      </div>
    </div>

    <div class="grid two" style="margin-top:12px;">
      <div class="card" style="margin:0">
        <div id="teacherCards" class="cards">
          <div class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</div>
        </div>
      </div>
      <div class="card" style="margin:0">
        <div id="topWrongBox">
          <div class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</div>
        </div>
      </div>
    </div>

    <div class="note small" style="margin-top:12px;">
      –ö–µ–π—ñ–Ω –º“±–Ω—ã Google Sheets/Firebase-–ø–µ–Ω –∂–∞—Å–∞—Å–∞“£ ‚Äî –¥–µ—Ä–µ–∫ –±–∞—Ä–ª—ã“õ “õ“±—Ä—ã–ª“ì—ã–¥–∞ —Å–∞“õ—Ç–∞–ª–∞–¥—ã.
    </div>
  </div>

</main>

<script>
  // =========================
  // 1) –û“ö–£–®–´ –õ–û–ì–ò–ù/–ü–ê–†–û–õ–¨ –¢–Ü–ó–Ü–ú–Ü
  // =========================
  // ”®–∑ —Å—ã–Ω—ã–±—ã“£–Ω—ã“£ –Ω–∞“õ—Ç—ã –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—ñ–Ω –æ—Å—ã –∂–µ—Ä–¥–µ–Ω –∞—É—ã—Å—Ç—ã—Ä–∞—Å—ã“£:
  const STUDENTS = [
    {login:"9a01", pass:"A1b2C3", fullname:"–ê–π–¥–∞–Ω–∞ –ù“±—Ä–ª–∞–Ω", cls:"9–ê"},
    {login:"9a02", pass:"Q7w8E9", fullname:"–î–∞–Ω–∏—è—Ä –¢–∞–ª“ì–∞—Ç", cls:"9–ê"},
    {login:"9a03", pass:"Z2x3C4", fullname:"–ê—Ä—É–∂–∞–Ω –ï—Ä–∫–µ–±“±–ª–∞–Ω", cls:"9–ê"},
    {login:"9a04", pass:"M5n6B7", fullname:"–ù“±—Ä—Å“±–ª—Ç–∞–Ω –ë–µ–∫", cls:"9–ê"},
    {login:"9a05", pass:"K9l8J7", fullname:"–ú–∞–¥–∏–Ω–∞ ”ò—Å–µ—Ç", cls:"9–ê"},
    {login:"9a06", pass:"P3o2I1", fullname:"”ò–ª–∏—Ö–∞–Ω –°–µ—Ä—ñ–∫", cls:"9–ê"},
    {login:"9a07", pass:"T4y5U6", fullname:"–ê–π–ª–∏–Ω –î”ô—É–ª–µ—Ç", cls:"9–ê"},
    {login:"9a08", pass:"R1t2Y3", fullname:"–î–∏–∞—Å –ù“±—Ä–∂–∞–Ω", cls:"9–ê"},
    {login:"9a09", pass:"V7b8N9", fullname:"–°—ã–º–±–∞—Ç “ö–∞–π—Ä–∞—Ç", cls:"9–ê"},
    {login:"9a10", pass:"S6d5F4", fullname:"–ï—Ä–∫–µ–Ω–∞–∑ –ñ–∞–Ω–∞—Ç", cls:"9–ê"},
  ];

  // –ú“±“ì–∞–ª—ñ–º –∞–∫–∫–∞—É–Ω—Ç—ã:
  const TEACHER = { login:"teacher", pass:"0000", role:"teacher" };

  // =========================
  // 2) 10 –°“∞–†–ê“ö (A/B/C –ö”®–†–°–ï–¢–Ü–õ–ú–ï–ô–î–Ü)
  // =========================
  const QUESTIONS = [
    {
      id: 1,
      q: "–≠–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ –Ω–µ?",
      options: [
        "–ó–∞—Ä—è–¥—Ç–∞–ª“ì–∞–Ω –±”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ“£ —Ä–µ—Ç—Ç–µ–ª–≥–µ–Ω “õ–æ–∑“ì–∞–ª—ã—Å—ã",
        "–¢–µ–∫ —ç–ª–µ–∫—Ç—Ä–æ–Ω–¥–∞—Ä–¥—ã“£ —Ö–∞–æ—Å—Ç—ã“õ “õ–æ–∑“ì–∞–ª—ã—Å—ã",
        "–î–µ–Ω–µ–Ω—ñ“£ “õ—ã–∑—É—ã–Ω—ã“£ –∞—Ä—Ç—É—ã",
        "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω—ñ“£ ”©–∑–≥–µ—Ä—É—ñ"
      ],
      correct: 0,
      explain: "–≠–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã ‚Äî –∑–∞—Ä—è–¥—Ç–∞–ª“ì–∞–Ω –±”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ“£ (—ç–ª–µ–∫—Ç—Ä–æ–Ω/–∏–æ–Ω) —Ä–µ—Ç—Ç–µ–ª–≥–µ–Ω “õ–æ–∑“ì–∞–ª—ã—Å—ã."
    },
    {
      id: 2,
      q: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ “õ–∞–Ω–¥–∞–π?",
      options: ["–ê–º–ø–µ—Ä (A)", "–í–æ–ª—å—Ç (V)", "–û–º (Œ©)", "–ö—É–ª–æ–Ω (C)"],
      correct: 1,
      explain: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ SI ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ ‚Äî –≤–æ–ª—å—Ç (V)."
    },
    {
      id: 3,
      q: "–û–º –∑–∞“£—ã (—Ç—ñ–∑–±–µ–∫ –±”©–ª—ñ–≥—ñ “Ø—à—ñ–Ω) –¥“±—Ä—ã—Å –∂–∞–∑—ã–ª“ì–∞–Ω —Ñ–æ—Ä–º—É–ª–∞:",
      options: ["I = U/R", "R = I/U", "U = I¬∑t", "P = U¬∑t"],
      correct: 0,
      explain: "–û–º –∑–∞“£—ã: I = U/R."
    },
    {
      id: 4,
      q: "–ï–∫—ñ –∫–µ–¥–µ—Ä–≥—ñ —Ç—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—Å–∞, —Ç–æ–ª—ã“õ –∫–µ–¥–µ—Ä–≥—ñ:",
      options: ["R = R1¬∑R2/(R1+R2)", "R = R1 + R2", "R = R1 - R2", "R = (R1+R2)/2"],
      correct: 1,
      explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É–¥–∞: R = R1 + R2."
    },
    {
      id: 5,
      q: "–¢–æ–∫ –∫“Ø—à—ñ 2 A, –∫–µ–¥–µ—Ä–≥—ñ 5 Œ©. –ö–µ—Ä–Ω–µ—É U = ?",
      options: ["2.5 V", "7 V", "10 V", "20 V"],
      correct: 2,
      explain: "U = I¬∑R = 2¬∑5 = 10 –í."
    },
    {
      id: 6,
      q: "–¢–æ–∫ –∫“Ø—à—ñ 3 A, –∫–µ—Ä–Ω–µ—É 12 V –±–æ–ª—Å–∞, “õ—É–∞—Ç P = ?",
      options: ["4 W", "9 W", "15 W", "36 W"],
      correct: 3,
      explain: "P = U¬∑I = 12¬∑3 = 36 –í—Ç."
    },
    {
      id: 7,
      q: "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω–¥–µ–≥—ñ —Ç–æ–∫ ”©—Ç–∫—ñ–∑–≥—ñ—à–∫–µ ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω –∫“Ø—à “õ–∞–ª–∞–π –∞—Ç–∞–ª–∞–¥—ã?",
      options: ["–ê—Ä—Ö–∏–º–µ–¥ –∫“Ø—à—ñ", "–ê–º–ø–µ—Ä –∫“Ø—à—ñ", "–ö—É–ª–æ–Ω –∫“Ø—à—ñ", "“Æ–π–∫–µ–ª—ñ—Å –∫“Ø—à—ñ"],
      correct: 1,
      explain: "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω–¥–µ–≥—ñ —Ç–æ–∫ ”©—Ç–∫—ñ–∑–≥—ñ—à–∫–µ ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω –∫“Ø—à ‚Äî –ê–º–ø–µ—Ä –∫“Ø—à—ñ."
    },
    {
      id: 8,
      q: "–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç—Ç—ñ–∫ –∏–Ω–¥—É–∫—Ü–∏—è “õ“±–±—ã–ª—ã—Å—ã:",
      options: [
        "–ó–∞—Ä—è–¥—Ç–∞—Ä–¥—ã“£ —Ç–∞—Ä—Ç—ã–ª—É—ã",
        "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, —Ç–æ–∫ –ø–∞–π–¥–∞ –±–æ–ª—É—ã",
        "”®–∑–≥–µ—Ä–º–µ–ª—ñ –º–∞–≥–Ω–∏—Ç –∞“ì—ã–Ω—ã –∫–µ–∑—ñ–Ω–¥–µ –∏–Ω–¥—É–∫—Ü–∏—è–ª—ã“õ –≠“ö–ö –ø–∞–π–¥–∞ –±–æ–ª—É—ã",
        "–¢—ñ–∑–±–µ–∫—Ç–µ–≥—ñ –∫–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ –∞—Ä—Ç—É—ã"
      ],
      correct: 2,
      explain: "–ú–∞–≥–Ω–∏—Ç –∞“ì—ã–Ω—ã ”©–∑–≥–µ—Ä—Å–µ, –∏–Ω–¥—É–∫—Ü–∏—è–ª—ã“õ –≠“ö–ö –ø–∞–π–¥–∞ –±–æ–ª–∞–¥—ã (–§–∞—Ä–∞–¥–µ–π –∑–∞“£—ã)."
    },
    {
      id: 9,
      q: "–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ —Å—ã—Ä—Ç“õ—ã ”©—Ä—ñ—Å —Å—ã–∑—ã“õ—Ç–∞—Ä—ã “õ–∞–π –±–∞“ì—ã—Ç—Ç–∞?",
      options: [
        "–û“£—Ç“Ø—Å—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç–µ–Ω —Å–æ–ª—Ç“Ø—Å—Ç—ñ–∫–∫–µ",
        "–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç–µ–Ω –æ“£—Ç“Ø—Å—Ç—ñ–∫–∫–µ",
        "–ï–∫—ñ –±–∞“ì—ã—Ç—Ç–∞ –¥–∞ –±—ñ—Ä–¥–µ–π",
        "”®—Ä—ñ—Å —Å—ã–∑—ã“õ—Ç–∞—Ä—ã –±–æ–ª–º–∞–π–¥—ã"
      ],
      correct: 1,
      explain: "–°—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ N ‚Üí S –±–∞“ì—ã—Ç—Ç–∞–ª“ì–∞–Ω."
    },
    {
      id: 10,
      q: "–≠–ª–µ–∫—Ç—Ä –∑–∞—Ä—è–¥—Ç—ã“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ “õ–∞–Ω–¥–∞–π?",
      options: ["–ù—å—é—Ç–æ–Ω (N)", "–î–∂–æ—É–ª—å (J)", "–ö—É–ª–æ–Ω (C)", "–í–∞—Ç—Ç (W)"],
      correct: 2,
      explain: "–≠–ª–µ–∫—Ç—Ä –∑–∞—Ä—è–¥—Ç—ã“£ SI ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ ‚Äî –∫—É–ª–æ–Ω (C)."
    }
  ];

  // =========================
  // STATE + STORAGE KEYS
  // =========================
  let ROLE = null;
  let currentUser = null; // {login, fullname, cls, role}
  let answers = {};       // qid -> chosen index
  let submitted = false;
  let wrongIds = [];
  let remedDone = false;

  // remediation picks: qid -> chosen
  let remedAnswers = {};
  let REF_MOOD = "";

  const K = {
    attempt: (login)=>`pm_attempt_${login}`,
    sent: "pm_sent_results_v2"
  };

  // UI helpers
  const $ = (id)=>document.getElementById(id);
  const show = (id)=>$(id).classList.remove("hide");
  const hide = (id)=>$(id).classList.add("hide");
  const lock = (id)=>$(id).classList.add("locked");
  const unlock = (id)=>$(id).classList.remove("locked");

  function setRole(r){
    ROLE = r;
    hide("roleCard"); show("loginCard");
    $("loginTitle").textContent = (r==="student") ? "–û“õ—É—à—ã –∫—ñ—Ä—É" : "–ú“±“ì–∞–ª—ñ–º –∫—ñ—Ä—É";
    $("loginHint").textContent = (r==="student")
      ? "–û“õ—É—à—ã –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å —Ç—ñ–∑—ñ–º –±–æ–π—ã–Ω—à–∞ –±–µ—Ä—ñ–ª–µ–¥—ñ."
      : "–ú“±“ì–∞–ª—ñ–º teacher/0000 –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä–µ–¥—ñ.";
    // reset fields
    $("login").value=""; $("pass").value="";
  }
  function backToRole(){
    ROLE=null;
    hide("loginCard"); show("roleCard");
  }

  function fillDemo(){
    if(ROLE==="student"){
      $("login").value = STUDENTS[0].login;
      $("pass").value = STUDENTS[0].pass;
    }else{
      $("login").value = TEACHER.login;
      $("pass").value = TEACHER.pass;
    }
  }

  function doLogin(){
    const login = $("login").value.trim();
    const pass = $("pass").value.trim();
    if(!login || !pass){ alert("–õ–æ–≥–∏–Ω –∂”ô–Ω–µ –ø–∞—Ä–æ–ª—å –µ–Ω–≥—ñ–∑."); return; }

    if(ROLE==="teacher"){
      if(login===TEACHER.login && pass===TEACHER.pass){
        currentUser = {login, fullname:"–ú“±“ì–∞–ª—ñ–º", cls:"‚Äî", role:"teacher"};
        hide("loginCard"); initTeacher(); return;
      }
      alert("–ú“±“ì–∞–ª—ñ–º –ª–æ–≥–∏–Ω—ñ/–ø–∞—Ä–æ–ª—ñ “õ–∞—Ç–µ."); return;
    }

    // student: find in list
    const st = STUDENTS.find(s=>s.login===login && s.pass===pass);
    if(!st){ alert("–û“õ—É—à—ã –ª–æ–≥–∏–Ω—ñ/–ø–∞—Ä–æ–ª—ñ “õ–∞—Ç–µ (—Ç—ñ–∑—ñ–º –±–æ–π—ã–Ω—à–∞ —Ç–µ–∫—Å–µ—Ä)."); return; }

    currentUser = {login: st.login, fullname: st.fullname, cls: st.cls, role:"student"};
    hide("loginCard"); initStudent();
  }

  function logout(){
    ROLE=null; currentUser=null;
    answers={}; submitted=false; wrongIds=[]; remedDone=false; remedAnswers={}; REF_MOOD="";
    hide("studentCard"); hide("teacherCard"); hide("remedCard"); hide("remedRevealCard");
    show("roleCard"); hide("loginCard");
    $("sendStatus").textContent="";
    $("remedStatus").textContent="";
  }

  // =========================
  // STUDENT FLOW
  // =========================
  function initStudent(){
    show("studentCard");
    $("studentMeta").textContent = `${currentUser.fullname} ‚Ä¢ ${currentUser.cls} ‚Ä¢ login: ${currentUser.login}`;

    const saved = localStorage.getItem(K.attempt(currentUser.login));
    if(saved){
      const st = JSON.parse(saved);
      answers = st.answers || {};
      submitted = !!st.submitted;
      wrongIds = st.wrongIds || [];
      remedDone = !!st.remedDone;
      remedAnswers = st.remedAnswers || {};
      REF_MOOD = st.refMood || "";
      // restore reflection fields
      setTimeout(()=>restoreReflection(st.reflection || {}), 0);
    }else{
      answers={}; submitted=false; wrongIds=[]; remedDone=false; remedAnswers={}; REF_MOOD="";
      setTimeout(()=>restoreReflection({}), 0);
    }

    renderStudentState();
    renderTest();
    renderResults();
    renderMoodUI();
  }

  function saveAttempt(extraReflection){
    if(!currentUser) return;
    const reflection = extraReflection || readReflection();
    localStorage.setItem(K.attempt(currentUser.login), JSON.stringify({
      answers, submitted, wrongIds, remedDone, remedAnswers,
      refMood: REF_MOOD, reflection
    }));
  }

  function renderStudentState(){
    if(!submitted){
      $("stateNote").innerHTML = `<b>1-“õ–∞–¥–∞–º:</b> –¢–µ—Å—Ç—Ç—ñ —Ç–∞–ø—Å—ã—Ä. –ñ–∞—É–∞–ø –±–µ—Ä–≥–µ–Ω —Å–∞–π—ã–Ω ‚Äú–î“±—Ä—ã—Å/“ö–∞—Ç–µ‚Äù –∂”ô–Ω–µ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ.`;
      $("ruleText").innerHTML = `
        <ul class="list">
          <li>–¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª“ì–∞–Ω–¥–∞ “õ–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ –∂–∞—Å–∞–ª–∞–¥—ã.</li>
          <li>“ö–∞—Ç–µ –±–æ–ª—Å–∞ ‚Üí <b>“õ–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ</b>.</li>
          <li>“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å—Ç–∞: <b>–¥“±—Ä—ã—Å –∂–∞—É–∞–ø —Å–æ“£—ã–Ω–¥–∞ “ì–∞–Ω–∞</b> –∞—à—ã–ª–∞–¥—ã.</li>
        </ul>`;
      lock("btnRemed"); lock("btnSend"); lock("btnRetry");
      return;
    }
    if(submitted && wrongIds.length===0){
      $("stateNote").innerHTML = `<b>–ñ–∞—Ä–∞–π—Å—ã“£!</b> “ö–∞—Ç–µ –∂–æ“õ. –†–µ—Ñ–ª–µ–∫—Å–∏—è–Ω—ã —Ç–æ–ª—Ç—ã—Ä—ã–ø, –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä–µ –∞–ª–∞—Å—ã“£.`;
      unlock("btnSend"); unlock("btnRetry"); lock("btnRemed");
      $("ruleText").innerHTML = `<ul class="list"><li>“ö–∞—Ç–µ –∂–æ“õ ‚Üí “õ–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å “õ–∞–∂–µ—Ç –µ–º–µ—Å.</li></ul>`;
      return;
    }
    if(submitted && wrongIds.length>0 && !remedDone){
      $("stateNote").innerHTML = `<b>2-“õ–∞–¥–∞–º:</b> “ö–∞—Ç–µ –±–∞—Ä. <b>“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</b> ”©—Ç–ø–µ–π—ñ–Ω—à–µ –∂—ñ–±–µ—Ä—É/“õ–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—É –∞—à—ã–ª–º–∞–π–¥—ã.`;
      unlock("btnRemed"); lock("btnSend"); lock("btnRetry");
      $("ruleText").innerHTML = `
        <ul class="list">
          <li>“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä ‚Äú–∂–∞–¥—Ç–∞‚Äù —Å–∞“õ—Ç–∞–ª–∞–¥—ã.</li>
          <li>“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å: –∞–ª–¥—ã–º–µ–Ω ”©–∑—ñ“£ —Ç“Ø–∑–µ—Ç–µ—Å—ñ“£, —Å–æ“£—ã–Ω–¥–∞ “ì–∞–Ω–∞ –¥“±—Ä—ã—Å –∂–∞—É–∞–ø/—Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∞—à—ã–ª–∞–¥—ã.</li>
          <li>–ê—è“õ—Ç–∞–ª—Å–∞ “ì–∞–Ω–∞ –∂—ñ–±–µ—Ä—É/“õ–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—É –∞—à—ã–ª–∞–¥—ã.</li>
        </ul>`;
      return;
    }
    if(submitted && wrongIds.length>0 && remedDone){
      $("stateNote").innerHTML = `<b class="success">‚úÖ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –∞—è“õ—Ç–∞–ª–¥—ã.</b> –ï–Ω–¥—ñ —Ä–µ—Ñ–ª–µ–∫—Å–∏—è–Ω—ã —Ç–æ–ª—Ç—ã—Ä—ã–ø, –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä–µ –∞–ª–∞—Å—ã“£.`;
      lock("btnRemed"); unlock("btnSend"); unlock("btnRetry");
      $("ruleText").innerHTML = `<ul class="list"><li>“ö–∞—Ç–µ–ª–µ—Ä —Ç“Ø–∑–µ—Ç—ñ–ª–¥—ñ ‚Üí –∂—ñ–±–µ—Ä—É–≥–µ –±–æ–ª–∞–¥—ã.</li></ul>`;
      return;
    }
  }

  function renderTest(){
    const host = $("testArea");
    host.innerHTML = `
      <div class="note">
        <b>–¢–µ—Å—Ç: –≠–ª–µ–∫—Ç—Ä –∂”ô–Ω–µ –ú–∞–≥–Ω–µ—Ç–∏–∑–º (10 —Å“±—Ä–∞“õ)</b>
        <div class="small">–¢”©–º–µ–Ω–¥–µ–≥—ñ —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ –∂–∞—É–∞–ø –±–µ—Ä. –°–æ“£—ã–Ω–¥–∞ ‚Äú–¢–µ—Å—Ç—Ç—ñ –∞—è“õ—Ç–∞—É‚Äù –±–∞—Å.</div>
      </div>
      <div id="qList"></div>
      <div class="btnrow" style="margin-top:12px;">
        <button class="btn" id="finishBtn" onclick="submitTest()">–¢–µ—Å—Ç—Ç—ñ –∞—è“õ—Ç–∞—É</button>
      </div>
    `;
    const qList = document.getElementById("qList");

    QUESTIONS.forEach((qq)=>{
      const chosen = (answers[qq.id] ?? null);
      const isAnswered = chosen!==null && chosen!==undefined;
      const isCorrect = isAnswered ? (chosen===qq.correct) : null;

      const statusClass = isAnswered ? (isCorrect ? "ok" : "bad") : "";
      const statusText = isAnswered ? (isCorrect ? "–î“±—Ä—ã—Å ‚úÖ" : "“ö–∞—Ç–µ ‚ùå") : "–ñ–∞—É–∞–ø –±–µ—Ä—ñ–ª–º–µ–≥–µ–Ω";

      const optsHtml = qq.options.map((opt, idx)=>{
        const checked = (chosen===idx) ? "checked" : "";
        return `
          <label class="opt">
            <input type="radio" name="q_${qq.id}" ${checked}
              onchange="pick(${qq.id}, ${idx})" ${submitted ? "disabled" : ""}/>
            <div><b>${String.fromCharCode(65+idx)})</b> ${opt}</div>
          </label>`;
      }).join("");

      const explainHtml = isAnswered ? `
        <div class="note ${isCorrect ? "ok" : "bad"}" style="margin-top:10px;border-style:solid;border-width:1px;">
          <b>${statusText}</b>
          <div class="small" style="margin-top:6px;"><b>–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b> ${qq.explain}</div>
          ${!isCorrect ? `<div class="small" style="margin-top:6px;"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> ${String.fromCharCode(65+qq.correct)}) ${qq.options[qq.correct]}</div>` : ""}
        </div>
      ` : "";

      const el = document.createElement("div");
      el.className = "q " + statusClass;
      el.innerHTML = `
        <div class="qhead">
          <div><b>${qq.id}. ${qq.q}</b></div>
          <span class="badge">${statusText}</span>
        </div>
        <div class="ans">${optsHtml}</div>
        ${explainHtml}
      `;
      qList.appendChild(el);
    });

    if(submitted){
      const b = document.getElementById("finishBtn");
      b.classList.add("locked");
      b.disabled = true;
      b.textContent = "–¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª“ì–∞–Ω";
    }
  }

  function pick(qid, idx){
    answers[qid] = idx;
    saveAttempt();
    renderTest(); // show explanation immediately
  }

  function submitTest(){
    const missing = QUESTIONS.filter(q=>answers[q.id]===undefined);
    if(missing.length){
      alert("–ë–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä: " + missing.map(m=>m.id).join(", "));
      return;
    }
    submitted = true;
    wrongIds = QUESTIONS.filter(q=>answers[q.id]!==q.correct).map(q=>q.id);
    remedDone = (wrongIds.length===0) ? true : false;
    remedAnswers = {}; // reset remed answers on new submit
    saveAttempt();
    renderStudentState();
    renderResults();
    renderTest();
    if(wrongIds.length>0) unlock("btnRemed");
  }

  function renderResults(){
    const total = QUESTIONS.length;
    const correct = QUESTIONS.filter(q=>answers[q.id]===q.correct).length;
    $("scoreLine").textContent = submitted ? `–ù”ô—Ç–∏–∂–µ: ${correct}/${total}` : "”ò–ª—ñ —Ç–∞–ø—Å—ã—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.";
    $("barFill").style.width = submitted ? `${Math.round((correct/total)*100)}%` : "0%";

    const wrongList = $("wrongList");
    wrongList.innerHTML = "";
    if(!submitted){
      wrongList.innerHTML = `<li class="muted">–¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª–º–∞“ì–∞–Ω.</li>`;
    }else if(wrongIds.length===0){
      wrongList.innerHTML = `<li>“ö–∞—Ç–µ –∂–æ“õ ‚úÖ</li>`;
    }else{
      wrongIds.forEach(id=>{
        const q = QUESTIONS.find(x=>x.id===id);
        const chosen = answers[id];
        wrongList.insertAdjacentHTML("beforeend",
          `<li><b>${id}.</b> ${q.q}<br/>
            <span class="small">–°–µ–Ω: ${String.fromCharCode(65+chosen)} ‚Ä¢ –î“±—Ä—ã—Å—ã: ${String.fromCharCode(65+q.correct)}</span>
          </li>`);
      });
    }
    renderStudentState();
  }

  // =========================
  // REFLECTION (chips + input)
  // =========================
  function renderMoodUI(){
    // activate chip if restored
    const chips = Array.from(document.querySelectorAll("#moodChips .chip"));
    chips.forEach(c=>{
      c.classList.toggle("active", REF_MOOD && c.textContent.trim()===REF_MOOD);
    });
    $("moodView").textContent = REF_MOOD ? ("–¢–∞“£–¥–∞–ª–¥—ã: " + REF_MOOD) : "–¢–∞“£–¥–∞–ª–º–∞–¥—ã";
  }

  function pickMood(m){
    REF_MOOD = m;
    const chips = Array.from(document.querySelectorAll("#moodChips .chip"));
    chips.forEach(c=>c.classList.toggle("active", c.textContent.trim()===m));
    $("moodView").textContent = "–¢–∞“£–¥–∞–ª–¥—ã: " + m;
    saveAttempt();
  }

  function readReflection(){
    const dif = [];
    if($("d_formula")?.checked) dif.push("–§–æ—Ä–º—É–ª–∞");
    if($("d_units")?.checked) dif.push("”®–ª—à–µ–º");
    if($("d_circuit")?.checked) dif.push("–°—Ö–µ–º–∞");
    if($("d_concept")?.checked) dif.push("–¢–µ–æ—Ä–∏—è");

    return {
      mood: REF_MOOD || "",
      difficulties: dif,
      next_step: $("nextStep")?.value.trim() || ""
    };
  }

  function restoreReflection(ref){
    // mood
    REF_MOOD = ref.mood || REF_MOOD || "";
    // checkboxes
    const dif = ref.difficulties || [];
    if($("d_formula")) $("d_formula").checked = dif.includes("–§–æ—Ä–º—É–ª–∞");
    if($("d_units")) $("d_units").checked = dif.includes("”®–ª—à–µ–º");
    if($("d_circuit")) $("d_circuit").checked = dif.includes("–°—Ö–µ–º–∞");
    if($("d_concept")) $("d_concept").checked = dif.includes("–¢–µ–æ—Ä–∏—è");
    if($("nextStep")) $("nextStep").value = ref.next_step || "";
    renderMoodUI();
  }

  // =========================
  // REMEDIATION (NO correct/explain until end)
  // =========================
  function openRemediation(){
    if(!submitted || wrongIds.length===0) return;
    hide("studentCard"); show("remedCard");
    hide("remedRevealCard");
    $("remedStatus").textContent="";
    renderRemed();
    saveAttempt();
  }

  function closeRemediation(){
    hide("remedCard"); show("studentCard");
    $("remedStatus").textContent="";
  }

  function renderRemed(){
    const host = $("remedArea");
    host.innerHTML = "";
    wrongIds.forEach((id)=>{
      const q = QUESTIONS.find(x=>x.id===id);
      const chosen = remedAnswers[id];
      const el = document.createElement("div");
      el.className = "q";
      el.innerHTML = `
        <div class="qhead">
          <div><b>${q.id}. ${q.q}</b></div>
          <span class="badge">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</span>
        </div>
        <div class="ans" style="margin-top:10px;">
          ${q.options.map((opt, idx)=>`
            <label class="opt">
              <input type="radio" name="r_${q.id}" ${chosen===idx?"checked":""}
                onchange="remedPick(${q.id}, ${idx})"/>
              <div><b>${String.fromCharCode(65+idx)})</b> ${opt}</div>
            </label>`).join("")}
        </div>
        <div class="small" id="rmsg_${q.id}" style="margin-top:8px;"></div>
      `;
      host.appendChild(el);

      // show only "chosen" status, no correct reveal
      if(chosen !== undefined){
        const msg = document.getElementById(`rmsg_${q.id}`);
        msg.innerHTML = `<span class="small">–ñ–∞—É–∞–ø –±–µ–ª–≥—ñ–ª–µ–Ω–¥—ñ ‚úÖ</span>`;
      }
    });
  }

  function remedPick(qid, idx){
    remedAnswers[qid] = idx;
    const msg = document.getElementById(`rmsg_${qid}`);
    if(msg) msg.innerHTML = `<span class="small">–ñ–∞—É–∞–ø –±–µ–ª–≥—ñ–ª–µ–Ω–¥—ñ ‚úÖ</span>`;
    saveAttempt();
  }

  function finishRemediation(){
    // must answer all wrong questions
    const missing = wrongIds.filter(id => remedAnswers[id] === undefined);
    if(missing.length){
      $("remedStatus").innerHTML = `<span class="danger">–ê–ª–¥—ã–º–µ–Ω –æ—Å—ã —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ –∂–∞—É–∞–ø –±–µ—Ä:</span> ${missing.join(", ")}`;
      return;
    }

    // check correctness
    const incorrect = wrongIds.filter(id=>{
      const q = QUESTIONS.find(x=>x.id===id);
      return remedAnswers[id] !== q.correct;
    });

    if(incorrect.length){
      $("remedStatus").innerHTML = `<span class="danger">”ò–ª—ñ “õ–∞—Ç–µ –±–∞—Ä.</span> “ö–∞–π—Ç–∞ “õ–∞—Ä–∞–ø —Ç“Ø–∑–µ—Ç: ${incorrect.join(", ")}`;
      // still no reveal of correct answers here
      return;
    }

    remedDone = true;
    saveAttempt();
    $("remedStatus").innerHTML = `<span class="success">‚úÖ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å —Ç–æ–ª—ã“õ ”©—Ç—Ç—ñ!</span> –ï–Ω–¥—ñ –¥“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç–∞—Ä –º–µ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∞—à—ã–ª–¥—ã.`;

    // Reveal correct answers ONLY NOW
    const reveal = $("remedReveal");
    reveal.innerHTML = "";
    wrongIds.forEach(id=>{
      const q = QUESTIONS.find(x=>x.id===id);
      const your = remedAnswers[id];
      reveal.insertAdjacentHTML("beforeend", `
        <div class="q ok">
          <div class="qhead">
            <div><b>${q.id}. ${q.q}</b></div>
            <span class="badge">–¢“Ø–∑–µ—Ç—ñ–ª–¥—ñ ‚úÖ</span>
          </div>
          <div class="small" style="margin-top:8px;">
            –°–µ–Ω—ñ“£ —Å–æ“£“ì—ã –∂–∞—É–∞–±—ã“£: <b>${String.fromCharCode(65+your)})</b>
          </div>
          <div class="note ok" style="margin-top:10px;border-style:solid;border-width:1px;">
            <div class="small"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> ${String.fromCharCode(65+q.correct)}) ${q.options[q.correct]}</div>
            <div class="small" style="margin-top:6px;"><b>–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b> ${q.explain}</div>
          </div>
        </div>
      `);
    });
    show("remedRevealCard");

    // back after a moment
    setTimeout(()=>{
      closeRemediation();
      renderStudentState();
      renderResults();
    }, 800);
  }

  function resetAttempt(){
    answers = {};
    submitted = false;
    wrongIds = [];
    remedDone = false;
    remedAnswers = {};
    saveAttempt();
    $("sendStatus").textContent="";
    hide("remedRevealCard");
    renderStudentState();
    renderTest();
    renderResults();
  }

  // =========================
  // SEND TO TEACHER (DEMO localStorage)
  // =========================
  function sendToTeacher(){
    if(!submitted){ alert("–ê–ª–¥—ã–º–µ–Ω —Ç–µ—Å—Ç—Ç—ñ —Ç–∞–ø—Å—ã—Ä."); return; }
    if(wrongIds.length>0 && !remedDone){ alert("“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ."); return; }

    const reflection = readReflection();
    // minimal reflection validation (optional)
    if(!reflection.mood){
      alert("–†–µ—Ñ–ª–µ–∫—Å–∏—è: —Å–µ–∑—ñ–º—ñ“£–¥—ñ —Ç–∞“£–¥–∞.");
      return;
    }

    const total = QUESTIONS.length;
    const correct = QUESTIONS.filter(q=>answers[q.id]===q.correct).length;
    const wrong = total - correct;

    // store per-question wrong list for TOP analytics
    const wrongQ = QUESTIONS.filter(q=>answers[q.id]!==q.correct).map(q=>q.id);

    const payload = {
      fullname: currentUser.fullname,
      cls: currentUser.cls,
      login: currentUser.login,
      score: `${correct}/${total}`,
      correctCount: correct,
      wrongCount: wrong,
      wrongQ,
      reflection,
      time: new Date().toLocaleString()
    };

    const arr = JSON.parse(localStorage.getItem(K.sent) || "[]");
    // replace last record for same student (keep only latest)
    const filtered = arr.filter(x=>x.login !== payload.login);
    filtered.push(payload);
    localStorage.setItem(K.sent, JSON.stringify(filtered));

    $("sendStatus").innerHTML = `<span class="success">–ñ—ñ–±–µ—Ä—ñ–ª–¥—ñ ‚úÖ</span> <span class="small">(DEMO)</span>`;
  }

  // =========================
  // TEACHER PANEL (cards + top wrong)
  // =========================
  function initTeacher(){
    show("teacherCard");
    refreshTeacher();
  }

  function refreshTeacher(){
    const arr = JSON.parse(localStorage.getItem(K.sent) || "[]");

    // CARDS
    const host = $("teacherCards");
    host.innerHTML = "";
    if(arr.length===0){
      host.innerHTML = `<div class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</div>`;
    }else{
      // sort by time not reliable in locale, but keep insertion order
      arr.slice().reverse().forEach(r=>{
        const ref = r.reflection || {};
        const mood = ref.mood || "‚Äî";
        const dif = (ref.difficulties || []).join(", ") || "‚Äî";
        const step = ref.next_step || "‚Äî";

        host.insertAdjacentHTML("beforeend", `
          <div class="kcard">
            <div class="khead">
              <div>
                <div class="kname">${escapeHtml(r.fullname)}</div>
                <div class="kmeta">${escapeHtml(r.cls)} ‚Ä¢ @${escapeHtml(r.login)}</div>
              </div>
              <div class="tag ${r.wrongCount===0 ? "ok":"bad"}">${escapeHtml(r.score)}</div>
            </div>

            <div class="kline"></div>

            <div class="krow">
              <span class="tag ${r.wrongCount===0 ? "ok":"bad"}">“ö–∞—Ç–µ: ${r.wrongCount}</span>
              <span class="tag">–°–µ–∑—ñ–º: ${escapeHtml(mood)}</span>
            </div>

            <div class="kmeta" style="margin-top:10px;"><b>“ö–∏–Ω–∞–ª–¥—ã:</b> ${escapeHtml(dif)}</div>
            <div class="kmeta" style="margin-top:6px;"><b>–ö–µ–ª–µ—Å—ñ “õ–∞–¥–∞–º:</b> ${escapeHtml(step)}</div>

            <div class="kmeta" style="margin-top:8px;"><b>“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä:</b> ${r.wrongQ?.length ? r.wrongQ.join(", ") : "–∂–æ“õ"}</div>

            <div class="kmeta" style="margin-top:8px;">${escapeHtml(r.time)}</div>
          </div>
        `);
      });
    }

    // TOP WRONG QUESTIONS
    const topBox = $("topWrongBox");
    topBox.innerHTML = "";
    if(arr.length===0){
      topBox.innerHTML = `<div class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</div>`;
      return;
    }

    const countMap = new Map(); // qid -> count
    arr.forEach(r=>{
      (r.wrongQ || []).forEach(id=>{
        countMap.set(id, (countMap.get(id) || 0) + 1);
      });
    });

    const sorted = Array.from(countMap.entries()).sort((a,b)=>b[1]-a[1]).slice(0,5);
    if(sorted.length===0){
      topBox.innerHTML = `<div class="small">“ö–∞—Ç–µ —Å“±—Ä–∞“õ –∂–æ“õ (–±”ô—Ä—ñ –¥“±—Ä—ã—Å).</div>`;
      return;
    }

    topBox.insertAdjacentHTML("beforeend", `<div class="note"><b>–¢–û–ü-5 “õ–∞—Ç–µ —Å“±—Ä–∞“õ</b><div class="small">“ö–∞–π —Å“±—Ä–∞“õ—Ç–∞–Ω –∫”©–ø “õ–∞—Ç–µ –∫–µ—Ç–∫–µ–Ω—ñ.</div></div>`);
    sorted.forEach(([qid, cnt])=>{
      const q = QUESTIONS.find(x=>x.id===qid);
      topBox.insertAdjacentHTML("beforeend", `
        <div class="kcard" style="box-shadow:none;">
          <div class="khead">
            <div><b>#${qid}</b> ${escapeHtml(q?.q || "")}</div>
            <span class="tag bad">“ö–∞—Ç–µ —Å–∞–Ω—ã: ${cnt}</span>
          </div>
        </div>
      `);
    });
  }

  function clearTeacherData(){
    if(!confirm("DEMO –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ ”©—à—ñ—Ä–µ–π—ñ–Ω –±–µ?")) return;
    localStorage.removeItem(K.sent);
    refreshTeacher();
  }

  function escapeHtml(s){
    return String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }
</script>
</body>
</html>
