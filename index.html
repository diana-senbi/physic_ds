<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhysicsMind ‚Äî –≠–ª–µ–∫—Ç—Ä –∂”ô–Ω–µ –ú–∞–≥–Ω–µ—Ç–∏–∑–º (9 —Å—ã–Ω—ã–ø)</title>
  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <style>
    :root{
      --bg:#F5F7FB; --card:#FFFFFF; --text:#0F172A; --muted:#64748B;
      --primary:#4F46E5; --primary2:#6366F1; --green:#16A34A; --red:#EF4444;
      --softBlue:#EEF2FF; --softGreen:#ECFDF5; --softRed:#FFF1F2;
      --shadow: 0 14px 35px rgba(15, 23, 42, .08);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;z-index:10;background:rgba(245,247,251,.85);
      backdrop-filter:blur(10px);border-bottom:1px solid rgba(100,116,139,.15)}
    .wrap{max-width:1050px;margin:0 auto;padding:14px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:999px;
      background:var(--card);box-shadow:var(--shadow)}
    .brand img{width:34px;height:34px;border-radius:10px;object-fit:cover;
      border:1px solid rgba(100,116,139,.18)}
    .brand b{font-size:14px}
    .brand span{display:block;font-size:12px;color:var(--muted);margin-top:2px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;
      background:var(--softBlue);color:#1E293B;font-size:12px;border:1px solid rgba(99,102,241,.18)}
    main{padding:16px}
    .card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);
      border:1px solid rgba(100,116,139,.10);padding:16px;margin:14px 0}
    .grid{display:grid;gap:12px}
    @media(min-width:820px){.grid.two{grid-template-columns:1fr 1fr}}
    h2,h3{margin:0}
    .title{font-size:18px}
    .muted{color:var(--muted);font-size:12px;line-height:1.4}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input,select{width:100%;padding:12px 12px;border-radius:14px;border:1px solid rgba(100,116,139,.20);
      outline:none;background:#fff;font-size:14px}
    input:focus,select:focus{border-color:rgba(79,70,229,.55);box-shadow:0 0 0 4px rgba(79,70,229,.12)}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap}
    button{border:none;border-radius:14px;padding:12px 14px;cursor:pointer;font-weight:800;letter-spacing:.2px}
    .btn{background:linear-gradient(135deg,var(--primary),var(--primary2));color:#fff}
    .btn.gray{background:#334155;color:#fff}
    .btn.green{background:linear-gradient(135deg,#16A34A,#22C55E);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(100,116,139,.25);color:#0F172A}
    .rolebtn{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px;border-radius:16px;border:1px solid rgba(100,116,139,.15);background:#fff}
    .rolebtn:hover{box-shadow:0 10px 24px rgba(15,23,42,.08)}
    .roleleft{display:flex;align-items:center;gap:10px}
    .icon{width:38px;height:38px;border-radius:14px;display:grid;place-items:center;background:var(--softBlue);
      border:1px solid rgba(79,70,229,.18);font-weight:900;color:#3730A3}
    .hide{display:none}
    .note{padding:12px;border-radius:14px;background:#fff;border:1px dashed rgba(100,116,139,.30)}
    .q{padding:12px;border-radius:16px;border:1px solid rgba(100,116,139,.18);background:#fff;margin-top:10px}
    .qhead{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap}
    .badge{font-size:11px;padding:6px 10px;border-radius:999px;border:1px solid rgba(100,116,139,.18);background:#F8FAFC;color:#334155}
    .ok{background:var(--softGreen);border-color:rgba(34,197,94,.25)}
    .bad{background:var(--softRed);border-color:rgba(239,68,68,.25)}
    .ans{display:grid;gap:8px;margin-top:10px}
    .opt{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:14px;
      border:1px solid rgba(100,116,139,.18);cursor:pointer}
    .opt input{width:auto;margin-top:2px}
    .opt:hover{background:#F8FAFC}
    .bar{height:10px;background:#E2E8F0;border-radius:999px;overflow:hidden}
    .bar > div{height:100%;background:linear-gradient(135deg,var(--primary),var(--primary2));width:0%}
    .list{padding-left:16px;margin:8px 0}
    .locked{opacity:.55;pointer-events:none;filter:grayscale(.2)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid rgba(100,116,139,.15);text-align:left;font-size:13px}
    th{color:#334155;background:#F8FAFC}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo" />
      <div>
        <b>PhysicsMind</b>
        <span>–≠–ª–µ–∫—Ç—Ä & –ú–∞–≥–Ω–µ—Ç–∏–∑–º ‚Ä¢ 9 —Å—ã–Ω—ã–ø</span>
      </div>
    </div>
    <span class="pill">üß† –®–µ–∫—Ç–µ—É–ª—ñ –∂–∞–¥—Ç—ã –ñ–ò ‚Ä¢ “ö–∞—Ç–µ —Ç–∞–ª–¥–∞—É ‚Ä¢ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</span>
  </div>
</header>

<main class="wrap">

  <!-- ROLE -->
  <div class="card" id="roleCard">
    <h2 class="title">–ö—ñ—Ä—É —Ä–µ–∂–∏–º—ñ–Ω —Ç–∞“£–¥–∞</h2>
    <p class="muted">–û“õ—É—à—ã —Ç–µ—Å—Ç —Ç–∞–ø—Å—ã—Ä–∞–¥—ã, –º“±“ì–∞–ª—ñ–º –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä–¥—ñ –∂”ô–Ω–µ “õ–∞—Ç–µ —Ç–∞–ª–¥–∞—É–¥—ã –∫”©—Ä–µ–¥—ñ.</p>
    <div class="grid two" style="margin-top:12px;">
      <button class="rolebtn" onclick="setRole('student')">
        <div class="roleleft">
          <div class="icon">–û</div>
          <div style="text-align:left">
            <b>–û“õ—É—à—ã –∫—ñ—Ä—É</b>
            <div class="muted">–¢–µ—Å—Ç ‚Ä¢ “õ–∞—Ç–µ –µ—Å–µ–ø ‚Ä¢ “õ–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</div>
          </div>
        </div>
        <span class="muted">‚Üí</span>
      </button>
      <button class="rolebtn" onclick="setRole('teacher')">
        <div class="roleleft">
          <div class="icon">–ú</div>
          <div style="text-align:left">
            <b>–ú“±“ì–∞–ª—ñ–º –∫—ñ—Ä—É</b>
            <div class="muted">–ù”ô—Ç–∏–∂–µ–ª–µ—Ä ‚Ä¢ —Å“±—Ä—ã–ø—Ç–∞—É ‚Ä¢ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
          </div>
        </div>
        <span class="muted">‚Üí</span>
      </button>
    </div>
    <div class="note muted" style="margin-top:12px;">
      –ï—Å–∫–µ—Ä—Ç—É: –±“±–ª ‚Äî –¥–µ–º–æ-–Ω“±—Å“õ–∞. ‚Äú–ù”ô—Ç–∏–∂–µ–Ω—ñ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä—É‚Äù –∫–µ–π—ñ–Ω Google Sheets/API –∞—Ä“õ—ã–ª—ã “õ–æ—Å—ã–ª–∞–¥—ã.
    </div>
  </div>

  <!-- LOGIN -->
  <div class="card hide" id="loginCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title" id="loginTitle">–ö—ñ—Ä—É</h2>
        <p class="muted" id="loginHint">–õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä.</p>
      </div>
      <button class="btn ghost" onclick="backToRole()">‚Üê –ê—Ä—Ç“õ–∞</button>
    </div>

    <div class="grid two" style="margin-top:10px;">
      <div>
        <label>–õ–æ–≥–∏–Ω</label>
        <input id="login" placeholder="–º—ã—Å: diana" />
      </div>
      <div>
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input id="pass" type="password" placeholder="–º—ã—Å: 1234" />
      </div>
      <div>
        <label>–°—ã–Ω—ã–ø</label>
        <select id="cls">
          <option value="9–ê">9–ê</option>
          <option value="9”ò">9”ò</option>
          <option value="9–ë">9–ë</option>
          <option value="9–í">9–í</option>
        </select>
      </div>
      <div>
        <label>–ê—Ç—ã-–∂”©–Ω—ñ</label>
        <input id="fullname" placeholder="–º—ã—Å: –î–∏–∞–Ω–∞ –î”ô—É–ª–µ—Ç" />
      </div>
    </div>

    <div class="btnrow" style="margin-top:12px;">
      <button class="btn" onclick="doLogin()">–ö—ñ—Ä—É</button>
      <button class="btn gray" onclick="fillDemo()">Demo —Ç–æ–ª—Ç—ã—Ä—É</button>
    </div>

    <div class="note small" style="margin-top:12px;">
      Demo –ª–æ–≥–∏–Ω–¥–µ—Ä:<br/>
      <b>–û“õ—É—à—ã</b>: login <code>student</code>, –ø–∞—Ä–æ–ª—å <code>1234</code><br/>
      <b>–ú“±“ì–∞–ª—ñ–º</b>: login <code>teacher</code>, –ø–∞—Ä–æ–ª—å <code>0000</code>
    </div>
  </div>

  <!-- STUDENT APP -->
  <div class="card hide" id="studentCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title">–û“õ—É—à—ã –ø–∞–Ω–µ–ª—ñ</h2>
        <p class="muted" id="studentMeta"></p>
      </div>
      <div class="btnrow">
        <button class="btn ghost" onclick="logout()">–®—ã“ì—É</button>
      </div>
    </div>

    <div class="note" id="stateNote" style="margin-top:12px;"></div>

    <div id="testArea" style="margin-top:12px;"></div>

    <div class="card" style="margin-top:12px;background:#fff;border:1px solid rgba(100,116,139,.15)">
      <h3 class="title">–ù”ô—Ç–∏–∂–µ</h3>
      <div style="margin-top:10px;">
        <div class="bar"><div id="barFill"></div></div>
        <div class="muted" id="scoreLine" style="margin-top:8px;">”ò–ª—ñ —Ç–∞–ø—Å—ã—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.</div>
      </div>

      <div class="grid two" style="margin-top:12px;">
        <div class="note" id="wrongListBox">
          <b>“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ</b>
          <ul class="list" id="wrongList"><li class="muted">”ò–∑—ñ—Ä–≥–µ –∂–æ“õ.</li></ul>
        </div>
        <div class="note">
          <b>–ï—Ä–µ–∂–µ (—à–µ–∫—Ç–µ—É–ª—ñ –∂–∞–¥ –ª–æ–≥–∏–∫–∞—Å—ã)</b>
          <div class="small" id="ruleText"></div>
        </div>
      </div>

      <div class="btnrow" style="margin-top:12px;">
        <button class="btn green locked" id="btnRemed" onclick="openRemediation()">‚úÖ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</button>
        <button class="btn locked" id="btnSend" onclick="sendToTeacher()">üì© –ù”ô—Ç–∏–∂–µ–Ω—ñ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä—É</button>
        <button class="btn ghost locked" id="btnRetry" onclick="resetAttempt()">“ö–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—É</button>
      </div>
      <div class="small" id="sendStatus" style="margin-top:8px;"></div>
    </div>
  </div>

  <!-- REMEDIATION -->
  <div class="card hide" id="remedCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</h2>
        <p class="muted">–¢”©–º–µ–Ω–¥–µ —Ç–µ–∫ —Å–µ–Ω “õ–∞—Ç–µ –∫–µ—Ç–∫–µ–Ω —Å“±—Ä–∞“õ—Ç–∞—Ä —à—ã“ì–∞–¥—ã. –î“±—Ä—ã—Å—Ç–∞–ø ”©—Ç–ø–µ–π—ñ–Ω—à–µ, “õ–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä–∞ –∞–ª–º–∞–π—Å—ã“£.</p>
      </div>
      <button class="btn ghost" onclick="closeRemediation()">‚Üê –ê—Ä—Ç“õ–∞</button>
    </div>

    <div id="remedArea" style="margin-top:12px;"></div>

    <div class="btnrow" style="margin-top:12px;">
      <button class="btn green" onclick="finishRemediation()">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å—Ç—ã –∞—è“õ—Ç–∞—É</button>
    </div>
    <div class="small" id="remedStatus" style="margin-top:8px;"></div>
  </div>

  <!-- TEACHER -->
  <div class="card hide" id="teacherCard">
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
      <div>
        <h2 class="title">–ú“±“ì–∞–ª—ñ–º –ø–∞–Ω–µ–ª—ñ (DEMO)</h2>
        <p class="muted">–ú“±–Ω–¥–∞ –Ω”ô—Ç–∏–∂–µ –∂–∏–Ω–∞—É/–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–æ–ª–∞–¥—ã. “ö–∞–∑—ñ—Ä localStorage –∞—Ä“õ—ã–ª—ã –¥–µ–º–æ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ.</p>
      </div>
      <div class="btnrow">
        <button class="btn ghost" onclick="logout()">–®—ã“ì—É</button>
        <button class="btn" onclick="refreshTeacher()">–ñ–∞“£–∞—Ä—Ç—É</button>
      </div>
    </div>

    <div class="grid two" style="margin-top:12px;">
      <div class="note">
        <b>–û“õ—É—à—ã–ª–∞—Ä –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ</b>
        <div class="small">–¢”©–º–µ–Ω–¥–µ ‚Äú–∂—ñ–±–µ—Ä—ñ–ª–≥–µ–Ω‚Äù –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä “ì–∞–Ω–∞ –∫”©—Ä—ñ–Ω–µ–¥—ñ.</div>
      </div>
      <div class="note">
        <b>–ï“£ –∫”©–ø “õ–∞—Ç–µ –∫–µ—Ç–∫–µ–Ω —Å“±—Ä–∞“õ—Ç–∞—Ä (–¢–û–ü)</b>
        <div class="small">–°“±—Ä—ã–ø—Ç–∞—É –∞–≤—Ç–æ–º–∞—Ç —Ç“Ø—Ä–¥–µ.</div>
      </div>
    </div>

    <div class="grid two" style="margin-top:10px;">
      <div class="card" style="margin:0">
        <table id="tblResults">
          <thead><tr><th>–û“õ—É—à—ã</th><th>–°—ã–Ω—ã–ø</th><th>–ë–∞–ª–ª</th><th>“ö–∞—Ç–µ</th><th>–£–∞“õ—ã—Ç—ã</th></tr></thead>
          <tbody><tr><td colspan="5" class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</td></tr></tbody>
        </table>
      </div>
      <div class="card" style="margin:0">
        <table id="tblTop">
          <thead><tr><th>–°“±—Ä–∞“õ</th><th>“ö–∞—Ç–µ —Å–∞–Ω—ã</th></tr></thead>
          <tbody><tr><td colspan="2" class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</td></tr></tbody>
        </table>
      </div>
    </div>

    <div class="note small" style="margin-top:12px;">
      –ö–µ–π—ñ–Ω ‚Äú–ù”ô—Ç–∏–∂–µ–Ω—ñ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä—É‚Äù ‚Üí Google Sheets / Firebase –∞—Ä“õ—ã–ª—ã –±–æ–ª–∞–¥—ã.
      “ö–∞–∑—ñ—Ä —Ç–µ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è.
    </div>
  </div>

</main>

<script>
  // ---------- DATA (10 —Å“±—Ä–∞“õ, A/B/C –∞—Ä–∞–ª–∞—Å) ----------
  const QUESTIONS = [
    {
      id: 1, level: "A",
      q: "–≠–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ –Ω–µ?",
      options: [
        "–ó–∞—Ä—è–¥—Ç–∞–ª“ì–∞–Ω –±”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ“£ —Ä–µ—Ç—Ç–µ–ª–≥–µ–Ω “õ–æ–∑“ì–∞–ª—ã—Å—ã",
        "–¢–µ–∫ —ç–ª–µ–∫—Ç—Ä–æ–Ω–¥–∞—Ä–¥—ã“£ —Ö–∞–æ—Å—Ç—ã“õ “õ–æ–∑“ì–∞–ª—ã—Å—ã",
        "–î–µ–Ω–µ–Ω—ñ“£ “õ—ã–∑—É—ã–Ω—ã“£ –∞—Ä—Ç—É—ã",
        "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω—ñ“£ ”©–∑–≥–µ—Ä—É—ñ"
      ],
      correct: 0,
      explain: "–≠–ª–µ–∫—Ç—Ä —Ç–æ–≥—ã ‚Äî –∑–∞—Ä—è–¥—Ç–∞–ª“ì–∞–Ω –±”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ“£ (—ç–ª–µ–∫—Ç—Ä–æ–Ω/–∏–æ–Ω) —Ä–µ—Ç—Ç–µ–ª–≥–µ–Ω “õ–æ–∑“ì–∞–ª—ã—Å—ã."
    },
    {
      id: 2, level: "A",
      q: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ “õ–∞–Ω–¥–∞–π?",
      options: ["–ê–º–ø–µ—Ä (A)", "–í–æ–ª—å—Ç (V)", "–û–º (Œ©)", "–ö—É–ª–æ–Ω (C)"],
      correct: 1,
      explain: "–ö–µ—Ä–Ω–µ—É–¥—ñ“£ SI ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ ‚Äî –≤–æ–ª—å—Ç (V)."
    },
    {
      id: 3, level: "B",
      q: "–û–º –∑–∞“£—ã (—Ç—ñ–∑–±–µ–∫ –±”©–ª—ñ–≥—ñ “Ø—à—ñ–Ω) –¥“±—Ä—ã—Å –∂–∞–∑—ã–ª“ì–∞–Ω —Ñ–æ—Ä–º—É–ª–∞:",
      options: ["I = U/R", "R = I/U", "U = I¬∑t", "P = U¬∑t"],
      correct: 0,
      explain: "–û–º –∑–∞“£—ã: I = U/R (—Ç–æ–∫ –∫“Ø—à—ñ –∫–µ—Ä–Ω–µ—É–≥–µ —Ç—É—Ä–∞, –∫–µ–¥–µ—Ä–≥—ñ–≥–µ –∫–µ—Ä—ñ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª)."
    },
    {
      id: 4, level: "B",
      q: "–ï–∫—ñ –∫–µ–¥–µ—Ä–≥—ñ —Ç—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—Å–∞, —Ç–æ–ª—ã“õ –∫–µ–¥–µ—Ä–≥—ñ:",
      options: ["R = R1¬∑R2/(R1+R2)", "R = R1 + R2", "R = R1 - R2", "R = (R1+R2)/2"],
      correct: 1,
      explain: "–¢—ñ–∑–±–µ–∫—Ç–µ–π “õ–æ—Å—ã–ª—É–¥–∞ –∫–µ–¥–µ—Ä–≥—ñ–ª–µ—Ä “õ–æ—Å—ã–ª–∞–¥—ã: R = R1 + R2."
    },
    {
      id: 5, level: "B",
      q: "–¢–æ–∫ –∫“Ø—à—ñ 2 A, –∫–µ–¥–µ—Ä–≥—ñ 5 Œ©. –ö–µ—Ä–Ω–µ—É U = ?",
      options: ["2.5 V", "7 V", "10 V", "20 V"],
      correct: 2,
      explain: "U = I¬∑R = 2¬∑5 = 10 –í."
    },
    {
      id: 6, level: "C",
      q: "–¢–æ–∫ –∫“Ø—à—ñ 3 A, –∫–µ—Ä–Ω–µ—É 12 V –±–æ–ª—Å–∞, “õ—É–∞—Ç P = ?",
      options: ["4 W", "9 W", "15 W", "36 W"],
      correct: 3,
      explain: "P = U¬∑I = 12¬∑3 = 36 –í—Ç."
    },
    {
      id: 7, level: "C",
      q: "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω–¥–µ–≥—ñ —Ç–æ–∫ ”©—Ç–∫—ñ–∑–≥—ñ—à–∫–µ ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω –∫“Ø—à “õ–∞–ª–∞–π –∞—Ç–∞–ª–∞–¥—ã?",
      options: ["–ê—Ä—Ö–∏–º–µ–¥ –∫“Ø—à—ñ", "–ê–º–ø–µ—Ä –∫“Ø—à—ñ", "–ö—É–ª–æ–Ω –∫“Ø—à—ñ", "“Æ–π–∫–µ–ª—ñ—Å –∫“Ø—à—ñ"],
      correct: 1,
      explain: "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ–Ω–¥–µ–≥—ñ —Ç–æ–∫ ”©—Ç–∫—ñ–∑–≥—ñ—à–∫–µ ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω –∫“Ø—à ‚Äî –ê–º–ø–µ—Ä –∫“Ø—à—ñ."
    },
    {
      id: 8, level: "B",
      q: "–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç—Ç—ñ–∫ –∏–Ω–¥—É–∫—Ü–∏—è “õ“±–±—ã–ª—ã—Å—ã: ",
      options: [
        "–ó–∞—Ä—è–¥—Ç–∞—Ä–¥—ã“£ —Ç–∞—Ä—Ç—ã–ª—É—ã",
        "–ú–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å—ñ —Ç“±—Ä–∞“õ—Ç—ã –±–æ–ª—Å–∞, —Ç–æ–∫ –ø–∞–π–¥–∞ –±–æ–ª—É—ã",
        "”®–∑–≥–µ—Ä–º–µ–ª—ñ –º–∞–≥–Ω–∏—Ç –∞“ì—ã–Ω—ã –∫–µ–∑—ñ–Ω–¥–µ –∏–Ω–¥—É–∫—Ü–∏—è–ª—ã“õ –≠“ö–ö –ø–∞–π–¥–∞ –±–æ–ª—É—ã",
        "–¢—ñ–∑–±–µ–∫—Ç–µ–≥—ñ –∫–µ–¥–µ—Ä–≥—ñ–Ω—ñ“£ –∞—Ä—Ç—É—ã"
      ],
      correct: 2,
      explain: "–ò–Ω–¥—É–∫—Ü–∏—è: –º–∞–≥–Ω–∏—Ç –∞“ì—ã–Ω—ã ”©–∑–≥–µ—Ä—Å–µ, –∏–Ω–¥—É–∫—Ü–∏—è–ª—ã“õ –≠“ö–ö –ø–∞–π–¥–∞ –±–æ–ª–∞–¥—ã (–§–∞—Ä–∞–¥–µ–π –∑–∞“£—ã)."
    },
    {
      id: 9, level: "C",
      q: "–¢“±—Ä–∞“õ—Ç—ã –º–∞–≥–Ω–∏—Ç—Ç—ñ“£ ”©—Ä—ñ—Å —Å—ã–∑—ã“õ—Ç–∞—Ä—ã “õ–∞–π –±–∞“ì—ã—Ç—Ç–∞ —à—ã“ì–∞–¥—ã?",
      options: [
        "–û“£—Ç“Ø—Å—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç–µ–Ω —Å–æ–ª—Ç“Ø—Å—Ç—ñ–∫–∫–µ",
        "–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –ø–æ–ª—é—Å—Ç–µ–Ω –æ“£—Ç“Ø—Å—Ç—ñ–∫–∫–µ (—Å—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ)",
        "–ï–∫—ñ –±–∞“ì—ã—Ç—Ç–∞ –¥–∞ –±—ñ—Ä–¥–µ–π",
        "”®—Ä—ñ—Å —Å—ã–∑—ã“õ—Ç–∞—Ä—ã –±–æ–ª–º–∞–π–¥—ã"
      ],
      correct: 1,
      explain: "–°—ã—Ä—Ç“õ—ã –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç–µ –º–∞–≥–Ω–∏—Ç ”©—Ä—ñ—Å —Å—ã–∑—ã“õ—Ç–∞—Ä—ã N (—Å–æ–ª—Ç“Ø—Å—Ç—ñ–∫) ‚Üí S (–æ“£—Ç“Ø—Å—Ç—ñ–∫) –±–∞“ì—ã—Ç—Ç–∞–ª“ì–∞–Ω."
    },
    {
      id: 10, level: "A",
      q: "–≠–ª–µ–∫—Ç—Ä –∑–∞—Ä—è–¥—Ç—ã“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ “õ–∞–Ω–¥–∞–π?",
      options: ["–ù—å—é—Ç–æ–Ω (N)", "–î–∂–æ—É–ª—å (J)", "–ö—É–ª–æ–Ω (C)", "–í–∞—Ç—Ç (W)"],
      correct: 2,
      explain: "–≠–ª–µ–∫—Ç—Ä –∑–∞—Ä—è–¥—Ç—ã“£ SI ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ ‚Äî –∫—É–ª–æ–Ω (C)."
    }
  ];

  // ---------- SIMPLE AUTH (DEMO) ----------
  const DEMO_USERS = {
    student: { pass: "1234", role: "student" },
    teacher: { pass: "0000", role: "teacher" }
  };

  // ---------- STATE ----------
  let ROLE = null;
  let currentUser = null; // {login, fullname, cls}
  let answers = {};       // qid -> chosen index
  let submitted = false;
  let wrongIds = [];
  let remedDone = false;

  // storage keys
  const K = {
    attempt: (login)=>`pm_attempt_${login}`,
    sent: "pm_sent_results"
  };

  // ---------- UI helpers ----------
  const $ = (id)=>document.getElementById(id);
  const show = (id)=>$(id).classList.remove("hide");
  const hide = (id)=>$(id).classList.add("hide");
  const lock = (id)=>$(id).classList.add("locked");
  const unlock = (id)=>$(id).classList.remove("locked");

  function setRole(r){
    ROLE = r;
    hide("roleCard"); show("loginCard");
    $("loginTitle").textContent = (r==="student") ? "–û“õ—É—à—ã –∫—ñ—Ä—É" : "–ú“±“ì–∞–ª—ñ–º –∫—ñ—Ä—É";
    $("loginHint").textContent = (r==="student")
      ? "–û“õ—É—à—ã –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å, —Å—ã–Ω—ã–ø –∂”ô–Ω–µ –∞—Ç—ã-–∂”©–Ω—ñ“£–¥—ñ –µ–Ω–≥—ñ–∑."
      : "–ú“±“ì–∞–ª—ñ–º –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä–µ–¥—ñ.";
  }
  function backToRole(){
    ROLE=null;
    hide("loginCard"); show("roleCard");
  }
  function fillDemo(){
    if(ROLE==="student"){
      $("login").value="student";
      $("pass").value="1234";
      $("cls").value="9–ê";
      $("fullname").value="–î–∏–∞–Ω–∞ –î”ô—É–ª–µ—Ç";
    }else{
      $("login").value="teacher";
      $("pass").value="0000";
      $("cls").value="9–ê";
      $("fullname").value="–ú“±“ì–∞–ª—ñ–º";
    }
  }

  function doLogin(){
    const login = $("login").value.trim();
    const pass = $("pass").value.trim();
    const cls = $("cls").value;
    const fullname = $("fullname").value.trim();

    if(!login || !pass){ alert("–õ–æ–≥–∏–Ω –∂”ô–Ω–µ –ø–∞—Ä–æ–ª—å –µ–Ω–≥—ñ–∑."); return; }
    if(ROLE==="student" && !fullname){ alert("–ê—Ç—ã-–∂”©–Ω—ñ“£–¥—ñ –µ–Ω–≥—ñ–∑."); return; }

    // demo auth check
    const u = DEMO_USERS[login];
    if(!u || u.pass!==pass){
      alert("–õ–æ–≥–∏–Ω –Ω–µ–º–µ—Å–µ –ø–∞—Ä–æ–ª—å “õ–∞—Ç–µ (demo).");
      return;
    }
    if(u.role!==ROLE){
      alert("–†”©–ª—ñ —Å”ô–π–∫–µ—Å –µ–º–µ—Å. –û“õ—É—à—ã“ì–∞ student, –º“±“ì–∞–ª—ñ–º–≥–µ teacher –∫—ñ—Ä.");
      return;
    }

    currentUser = { login, fullname: fullname || "–ú“±“ì–∞–ª—ñ–º", cls };
    hide("loginCard");
    if(ROLE==="student"){ initStudent(); }
    else { initTeacher(); }
  }

  function logout(){
    ROLE=null; currentUser=null;
    answers={}; submitted=false; wrongIds=[]; remedDone=false;
    hide("studentCard"); hide("teacherCard"); hide("remedCard");
    show("roleCard"); hide("loginCard");
    $("sendStatus").textContent="";
    $("remedStatus").textContent="";
  }

  // ---------- STUDENT FLOW ----------
  function initStudent(){
    show("studentCard");
    $("studentMeta").textContent = `${currentUser.fullname} ‚Ä¢ ${currentUser.cls} ‚Ä¢ login: ${currentUser.login}`;

    // load attempt
    const saved = localStorage.getItem(K.attempt(currentUser.login));
    if(saved){
      const st = JSON.parse(saved);
      answers = st.answers || {};
      submitted = !!st.submitted;
      wrongIds = st.wrongIds || [];
      remedDone = !!st.remedDone;
    }else{
      answers={}; submitted=false; wrongIds=[]; remedDone=false;
    }

    renderStudentState();
    renderTest();
    renderResults();
  }

  function saveAttempt(){
    if(!currentUser) return;
    localStorage.setItem(K.attempt(currentUser.login), JSON.stringify({
      answers, submitted, wrongIds, remedDone
    }));
  }

  function renderStudentState(){
    if(!submitted){
      $("stateNote").innerHTML = `<b>1-“õ–∞–¥–∞–º:</b> –¢–µ—Å—Ç—Ç—ñ —Ç–∞–ø—Å—ã—Ä. ”ò—Ä –∂–∞—É–∞–ø—Ç–∞–Ω –∫–µ–π—ñ–Ω —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ –∫”©—Ä–µ—Å—ñ“£.`;
      $("ruleText").innerHTML = `
        <ul class="list">
          <li>–ñ–∞—É–∞–ø –±–µ—Ä–≥–µ–Ω —Å–æ“£ –¥“±—Ä—ã—Å/–±“±—Ä—ã—Å –∂”ô–Ω–µ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ —à—ã“ì–∞–¥—ã.</li>
          <li>–¢–µ—Å—Ç—Ç—ñ —Ç–æ–ª—ã“õ —Ç–∞–ø—Å—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω “õ–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ –∂–∞—Å–∞–ª–∞–¥—ã.</li>
          <li>“ö–∞—Ç–µ –±–æ–ª—Å–∞ ‚Äî <b>‚Äú“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å‚Äù –º—ñ–Ω–¥–µ—Ç—Ç—ñ</b>.</li>
        </ul>`;
      lock("btnRemed"); lock("btnSend"); lock("btnRetry");
      return;
    }
    if(submitted && wrongIds.length===0){
      $("stateNote").innerHTML = `<b>–ñ–∞—Ä–∞–π—Å—ã“£!</b> “ö–∞—Ç–µ –∂–æ“õ. –ù”ô—Ç–∏–∂–µ–Ω—ñ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä–µ –∞–ª–∞—Å—ã“£.`;
      unlock("btnSend"); unlock("btnRetry"); lock("btnRemed");
      $("ruleText").innerHTML = `<ul class="list"><li>“ö–∞—Ç–µ –∂–æ“õ ‚Üí ‚Äú“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å‚Äù “õ–∞–∂–µ—Ç –µ–º–µ—Å.</li></ul>`;
      return;
    }
    if(submitted && wrongIds.length>0 && !remedDone){
      $("stateNote").innerHTML = `<b>2-“õ–∞–¥–∞–º:</b> “ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä –±–∞—Ä. <b>“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</b> –∂–∞—Å–∞–º–∞–π—ã–Ω—à–∞ –Ω”ô—Ç–∏–∂–µ –∂—ñ–±–µ—Ä—ñ–ª–º–µ–π–¥—ñ –∂”ô–Ω–µ “õ–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä–∞ –∞–ª–º–∞–π—Å—ã“£.`;
      unlock("btnRemed"); lock("btnSend"); lock("btnRetry");
      $("ruleText").innerHTML = `
        <ul class="list">
          <li>“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä ‚Äú–∂–∞–¥—Ç–∞‚Äù —Å–∞“õ—Ç–∞–ª–∞–¥—ã (“õ–∞—Ç–µ —Ç—ñ–∑—ñ–º—ñ).</li>
          <li>“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å: —Ç–µ–∫ “õ–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä “õ–∞–π—Ç–∞–ª–∞–Ω–∞–¥—ã + —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ.</li>
          <li>“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –∞—è“õ—Ç–∞–ª—Å–∞ “ì–∞–Ω–∞ –∂—ñ–±–µ—Ä—É/“õ–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—É –∞—à—ã–ª–∞–¥—ã.</li>
        </ul>`;
      return;
    }
    if(submitted && wrongIds.length>0 && remedDone){
      $("stateNote").innerHTML = `<b>‚úÖ “ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –∞—è“õ—Ç–∞–ª–¥—ã.</b> –ï–Ω–¥—ñ –Ω”ô—Ç–∏–∂–µ–Ω—ñ –º“±“ì–∞–ª—ñ–º–≥–µ –∂—ñ–±–µ—Ä–µ –∞–ª–∞—Å—ã“£ –Ω–µ–º–µ—Å–µ “õ–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä–∞ –∞–ª–∞—Å—ã“£.`;
      lock("btnRemed"); unlock("btnSend"); unlock("btnRetry");
      $("ruleText").innerHTML = `<ul class="list"><li>“ö–∞—Ç–µ–ª–µ—Ä —Ç“Ø–∑–µ—Ç—ñ–ª–¥—ñ ‚Üí –∂—ñ–±–µ—Ä–µ –∞–ª–∞—Å—ã“£.</li></ul>`;
      return;
    }
  }

  function renderTest(){
    const host = $("testArea");
    host.innerHTML = `
      <div class="note">
        <b>–¢–µ—Å—Ç: –≠–ª–µ–∫—Ç—Ä –∂”ô–Ω–µ –ú–∞–≥–Ω–µ—Ç–∏–∑–º (10 —Å“±—Ä–∞“õ)</b>
        <div class="small">A/B/C –¥–µ“£–≥–µ–π–ª–µ—Ä—ñ –∞—Ä–∞–ª–∞—Å. –ñ–∞—É–∞–ø –±–µ—Ä—ñ–ø –±–æ–ª“ì–∞–Ω —Å–æ“£ ‚Äú–¢–µ—Å—Ç—Ç—ñ –∞—è“õ—Ç–∞—É‚Äù –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –±–∞—Å.</div>
      </div>
      <div id="qList"></div>
      <div class="btnrow" style="margin-top:12px;">
        <button class="btn" onclick="submitTest()">–¢–µ—Å—Ç—Ç—ñ –∞—è“õ—Ç–∞—É</button>
      </div>
    `;
    const qList = document.getElementById("qList");

    QUESTIONS.forEach((qq)=>{
      const chosen = (answers[qq.id] ?? null);
      const isAnswered = chosen!==null && chosen!==undefined;
      const isCorrect = isAnswered ? (chosen===qq.correct) : null;

      const statusClass = isAnswered ? (isCorrect ? "ok" : "bad") : "";
      const statusText = isAnswered ? (isCorrect ? "–î“±—Ä—ã—Å ‚úÖ" : "“ö–∞—Ç–µ ‚ùå") : "–ñ–∞—É–∞–ø –±–µ—Ä—ñ–ª–º–µ–≥–µ–Ω";

      const optsHtml = qq.options.map((opt, idx)=>{
        const checked = (chosen===idx) ? "checked" : "";
        return `
          <label class="opt">
            <input type="radio" name="q_${qq.id}" ${checked}
              onchange="pick(${qq.id}, ${idx})" ${submitted ? "disabled" : ""}/>
            <div>
              <div><b>${String.fromCharCode(65+idx)})</b> ${opt}</div>
            </div>
          </label>`;
      }).join("");

      const explainHtml = isAnswered ? `
        <div class="note ${isCorrect ? "ok" : "bad"}" style="margin-top:10px;">
          <b>${statusText}</b>
          <div class="small" style="margin-top:6px;"><b>–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b> ${qq.explain}</div>
          ${!isCorrect ? `<div class="small" style="margin-top:6px;"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> ${String.fromCharCode(65+qq.correct)}) ${qq.options[qq.correct]}</div>` : ""}
        </div>
      ` : "";

      const el = document.createElement("div");
      el.className = "q " + statusClass;
      el.innerHTML = `
        <div class="qhead">
          <div>
            <b>${qq.id}. ${qq.q}</b>
            <div class="small">–î–µ“£–≥–µ–π: <span class="badge">${qq.level}</span></div>
          </div>
          <span class="badge">${statusText}</span>
        </div>
        <div class="ans">${optsHtml}</div>
        ${explainHtml}
      `;
      qList.appendChild(el);
    });

    // disable finish button if already submitted
    if(submitted){
      host.querySelector("button.btn").classList.add("locked");
      host.querySelector("button.btn").disabled = true;
      host.querySelector("button.btn").textContent = "–¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª“ì–∞–Ω";
    }
  }

  function pick(qid, idx){
    answers[qid] = idx;
    saveAttempt();
    // rerender only to show explanation immediately
    renderTest();
  }

  function submitTest(){
    // check all answered
    const missing = QUESTIONS.filter(q=>answers[q.id]===undefined);
    if(missing.length){
      alert("–ë–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä: " + missing.map(m=>m.id).join(", "));
      return;
    }
    submitted = true;
    wrongIds = QUESTIONS.filter(q=>answers[q.id]!==q.correct).map(q=>q.id);
    remedDone = (wrongIds.length===0) ? true : false; // if no wrong -> treated as done
    saveAttempt();
    renderStudentState();
    renderResults();
    renderTest();
    if(wrongIds.length>0) unlock("btnRemed");
  }

  function renderResults(){
    const total = QUESTIONS.length;
    const correct = QUESTIONS.filter(q=>answers[q.id]===q.correct).length;
    const score = `${correct}/${total}`;
    $("scoreLine").textContent = submitted ? `–ù”ô—Ç–∏–∂–µ: ${score}` : "”ò–ª—ñ —Ç–∞–ø—Å—ã—Ä—ã–ª“ì–∞–Ω –∂–æ“õ.";
    $("barFill").style.width = submitted ? `${Math.round((correct/total)*100)}%` : "0%";

    const wrongList = $("wrongList");
    wrongList.innerHTML = "";
    if(!submitted){
      wrongList.innerHTML = `<li class="muted">–¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª–º–∞“ì–∞–Ω.</li>`;
    }else if(wrongIds.length===0){
      wrongList.innerHTML = `<li>“ö–∞—Ç–µ –∂–æ“õ ‚úÖ</li>`;
    }else{
      wrongIds.forEach(id=>{
        const q = QUESTIONS.find(x=>x.id===id);
        const chosen = answers[id];
        wrongList.insertAdjacentHTML("beforeend",
          `<li><b>${id}.</b> ${q.q}<br/>
            <span class="small">–°–µ–Ω—ñ“£ –∂–∞—É–∞–±—ã“£: ${String.fromCharCode(65+chosen)} | –î“±—Ä—ã—Å—ã: ${String.fromCharCode(65+q.correct)}</span>
          </li>`);
      });
    }

    // unlock/lock buttons according to state
    renderStudentState();
  }

  function openRemediation(){
    if(!submitted || wrongIds.length===0) return;
    hide("studentCard"); show("remedCard");
    renderRemed();
  }

  function closeRemediation(){
    hide("remedCard"); show("studentCard");
    $("remedStatus").textContent="";
  }

  function renderRemed(){
    const host = $("remedArea");
    host.innerHTML = "";
    if(wrongIds.length===0){
      host.innerHTML = `<div class="note ok"><b>“ö–∞—Ç–µ –∂–æ“õ.</b></div>`;
      return;
    }
    wrongIds.forEach((id)=>{
      const q = QUESTIONS.find(x=>x.id===id);
      const el = document.createElement("div");
      el.className = "q";
      el.innerHTML = `
        <div class="qhead">
          <div><b>${q.id}. ${q.q}</b><div class="small">–î–µ“£–≥–µ–π: <span class="badge">${q.level}</span></div></div>
          <span class="badge">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å</span>
        </div>
        <div class="note" style="margin-top:10px;">
          <b>–¢“Ø—Å—ñ–Ω–¥—ñ—Ä–º–µ:</b> <span class="small">${q.explain}</span><br/>
          <span class="small"><b>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</b> ${String.fromCharCode(65+q.correct)}) ${q.options[q.correct]}</span>
        </div>
        <div class="ans" style="margin-top:10px;">
          ${q.options.map((opt, idx)=>`
            <label class="opt">
              <input type="radio" name="r_${q.id}" onchange="remedPick(${q.id}, ${idx})"/>
              <div><b>${String.fromCharCode(65+idx)})</b> ${opt}</div>
            </label>`).join("")}
        </div>
        <div class="small" id="remed_msg_${q.id}" style="margin-top:8px;"></div>
      `;
      host.appendChild(el);
    });
  }

  function remedPick(qid, idx){
    const q = QUESTIONS.find(x=>x.id===qid);
    const msg = document.getElementById(`remed_msg_${qid}`);
    if(idx===q.correct){
      msg.innerHTML = `<span style="color:var(--green);font-weight:800">–î“±—Ä—ã—Å ‚úÖ</span>`;
      msg.dataset.ok = "1";
    }else{
      msg.innerHTML = `<span style="color:var(--red);font-weight:800">“ö–∞—Ç–µ ‚ùå</span> <span class="small">“ö–∞–π—Ç–∞ –æ–π–ª–∞–Ω.</span>`;
      msg.dataset.ok = "0";
    }
  }

  function finishRemediation(){
    // check all wrong questions corrected
    let allOk = true;
    wrongIds.forEach((id)=>{
      const msg = document.getElementById(`remed_msg_${id}`);
      if(!msg || msg.dataset.ok!=="1") allOk=false;
    });
    if(!allOk){
      $("remedStatus").innerHTML = `<span style="color:var(--red);font-weight:800">–ë–∞—Ä–ª—ã“õ “õ–∞—Ç–µ —Å“±—Ä–∞“õ—Ç—ã –¥“±—Ä—ã—Å—Ç–∞–ø ”©—Ç.</span>`;
      return;
    }
    remedDone = true;
    saveAttempt();
    $("remedStatus").innerHTML = `<span style="color:var(--green);font-weight:800">“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –∞—è“õ—Ç–∞–ª–¥—ã ‚úÖ</span>`;
    // go back
    setTimeout(()=>{ closeRemediation(); renderStudentState(); renderResults(); }, 600);
  }

  function resetAttempt(){
    if(!submitted) return;
    answers = {};
    submitted = false;
    wrongIds = [];
    remedDone = false;
    saveAttempt();
    $("sendStatus").textContent="";
    renderStudentState();
    renderTest();
    renderResults();
  }

  // ‚ÄúSend to teacher‚Äù demo: store to localStorage list
  function sendToTeacher(){
    if(!submitted){ alert("–ê–ª–¥—ã–º–µ–Ω —Ç–µ—Å—Ç—Ç—ñ —Ç–∞–ø—Å—ã—Ä."); return; }
    if(wrongIds.length>0 && !remedDone){ alert("“ö–∞—Ç–µ–º–µ–Ω –∂“±–º—ã—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ."); return; }

    const total = QUESTIONS.length;
    const correct = QUESTIONS.filter(q=>answers[q.id]===q.correct).length;

    const payload = {
      fullname: currentUser.fullname,
      cls: currentUser.cls,
      login: currentUser.login,
      score: `${correct}/${total}`,
      wrongCount: total - correct,
      time: new Date().toLocaleString()
    };

    const arr = JSON.parse(localStorage.getItem(K.sent) || "[]");
    arr.push(payload);
    localStorage.setItem(K.sent, JSON.stringify(arr));

    $("sendStatus").innerHTML = `<span style="color:var(--green);font-weight:800">–ñ—ñ–±–µ—Ä—ñ–ª–¥—ñ ‚úÖ</span> <span class="small">(DEMO)</span>`;
  }

  // ---------- TEACHER ----------
  function initTeacher(){
    show("teacherCard");
    refreshTeacher();
  }
  function refreshTeacher(){
    const arr = JSON.parse(localStorage.getItem(K.sent) || "[]");
    // results table
    const tbody = $("tblResults").querySelector("tbody");
    tbody.innerHTML = "";
    if(arr.length===0){
      tbody.innerHTML = `<tr><td colspan="5" class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</td></tr>`;
    }else{
      arr.slice().reverse().forEach(r=>{
        tbody.insertAdjacentHTML("beforeend",
          `<tr>
            <td><b>${escapeHtml(r.fullname)}</b><div class="small">@${escapeHtml(r.login)}</div></td>
            <td>${escapeHtml(r.cls)}</td>
            <td>${escapeHtml(r.score)}</td>
            <td>${r.wrongCount}</td>
            <td class="small">${escapeHtml(r.time)}</td>
          </tr>`);
      });
    }

    // top wrong questions (simple demo: aggregate wrongCount only, not per-question)
    // Better: count per-question, but we didn't store per-question here. We'll simulate:
    const topTbody = $("tblTop").querySelector("tbody");
    topTbody.innerHTML = "";
    if(arr.length===0){
      topTbody.innerHTML = `<tr><td colspan="2" class="small">”ò–∑—ñ—Ä—à–µ –¥–µ—Ä–µ–∫ –∂–æ“õ.</td></tr>`;
    }else{
      // DEMO: show fixed "likely" top list based on typical mistakes:
      const demoTop = [
        {q:"‚Ññ8 –ò–Ω–¥—É–∫—Ü–∏—è (–§–∞—Ä–∞–¥–µ–π –∑–∞“£—ã)", n: Math.max(1, Math.floor(arr.length*0.6))},
        {q:"‚Ññ6 “ö—É–∞—Ç P = U¬∑I", n: Math.max(1, Math.floor(arr.length*0.5))},
        {q:"‚Ññ7 –ê–º–ø–µ—Ä –∫“Ø—à—ñ", n: Math.max(1, Math.floor(arr.length*0.4))}
      ];
      demoTop.forEach(x=>{
        topTbody.insertAdjacentHTML("beforeend",
          `<tr><td>${escapeHtml(x.q)}</td><td>${x.n}</td></tr>`);
      });
      topTbody.insertAdjacentHTML("beforeend",
        `<tr><td colspan="2" class="small">–ï—Å–∫–µ—Ä—Ç—É: –ë“±–ª –¢–û–ü ‚Äî –¥–µ–º–æ. –ö–µ–π—ñ–Ω –Ω–∞“õ—Ç—ã —Å“±—Ä–∞“õ—Ç—ã“õ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ “õ–æ—Å–∞–º—ã–∑.</td></tr>`);
    }
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }
</script>
</body>
</html>
